<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Search Elasticsearch from Java using High Level Client | s9a.me</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="In [the last post]({% post_url elasticsearch/2019-11-25-connecting-to-elasticsearch-from-java %}) we saw how to connect to Elasticsearch using the High Level Client.
match_all Query using Java client The client provides many high level methods to build an Elasticsearch query. To keep it simple, let&rsquo;s see how to construct a simple match_all query:
SearchRequest request = new SearchRequest(&#34;online&#34;); // -- 1 SearchSourceBuilder builder = new SearchSourceBuilder(); // -- 2 builder.query(QueryBuilders.matchAllQuery()); request.source(builder); // -- 3 Parameter to the constructor is the index you want to query, this can be left empty and all the indices will be queried SearchSourceBuilder is used to create a search request."><meta name=generator content="Hugo 0.109.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=/css/syntax.css><link rel=stylesheet href=/css/style.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&family=Source+Sans+Pro:wght@200;300;400;700;900&display=swap"><meta property="og:title" content="Search Elasticsearch from Java using High Level Client"><meta property="og:description" content="In [the last post]({% post_url elasticsearch/2019-11-25-connecting-to-elasticsearch-from-java %}) we saw how to connect to Elasticsearch using the High Level Client.
match_all Query using Java client The client provides many high level methods to build an Elasticsearch query. To keep it simple, let&rsquo;s see how to construct a simple match_all query:
SearchRequest request = new SearchRequest(&#34;online&#34;); // -- 1 SearchSourceBuilder builder = new SearchSourceBuilder(); // -- 2 builder.query(QueryBuilders.matchAllQuery()); request.source(builder); // -- 3 Parameter to the constructor is the index you want to query, this can be left empty and all the indices will be queried SearchSourceBuilder is used to create a search request."><meta property="og:type" content="article"><meta property="og:url" content="/elasticsearch/search-match-all-from-java-using-high-level-client/"><meta property="og:image" content="/images/slipbox.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-11-26T00:00:00+00:00"><meta property="article:modified_time" content="2019-11-26T00:00:00+00:00"><meta property="og:site_name" content="sureshsarda.me"><meta itemprop=name content="Search Elasticsearch from Java using High Level Client"><meta itemprop=description content="In [the last post]({% post_url elasticsearch/2019-11-25-connecting-to-elasticsearch-from-java %}) we saw how to connect to Elasticsearch using the High Level Client.
match_all Query using Java client The client provides many high level methods to build an Elasticsearch query. To keep it simple, let&rsquo;s see how to construct a simple match_all query:
SearchRequest request = new SearchRequest(&#34;online&#34;); // -- 1 SearchSourceBuilder builder = new SearchSourceBuilder(); // -- 2 builder.query(QueryBuilders.matchAllQuery()); request.source(builder); // -- 3 Parameter to the constructor is the index you want to query, this can be left empty and all the indices will be queried SearchSourceBuilder is used to create a search request."><meta itemprop=datePublished content="2019-11-26T00:00:00+00:00"><meta itemprop=dateModified content="2019-11-26T00:00:00+00:00"><meta itemprop=wordCount content="397"><meta itemprop=image content="/images/slipbox.jpg"><meta itemprop=keywords content="Elasticsearch,Java,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/images/slipbox.jpg"><meta name=twitter:title content="Search Elasticsearch from Java using High Level Client"><meta name=twitter:description content="In [the last post]({% post_url elasticsearch/2019-11-25-connecting-to-elasticsearch-from-java %}) we saw how to connect to Elasticsearch using the High Level Client.
match_all Query using Java client The client provides many high level methods to build an Elasticsearch query. To keep it simple, let&rsquo;s see how to construct a simple match_all query:
SearchRequest request = new SearchRequest(&#34;online&#34;); // -- 1 SearchSourceBuilder builder = new SearchSourceBuilder(); // -- 2 builder.query(QueryBuilders.matchAllQuery()); request.source(builder); // -- 3 Parameter to the constructor is the index you want to query, this can be left empty and all the indices will be queried SearchSourceBuilder is used to create a search request."></head><body class="bg-slate-100 dark:bg-slate-900"><main><article class="center bg-white relative max-w-4xl mx-auto px-12 py-16"><header class="border-b-2 mb-8"><aside><a href=/ class="font-semibold text-base uppercase text-sky-700">HOME</a>
<a href=/category/how-to class="font-semibold text-base uppercase text-sky-700">&bull; HOW TO</a></aside><h1 class="text-5xl my-4">Search Elasticsearch from Java using High Level Client</h1><div class=mb-12><time class="text-base text-gray-700" datetime=2019-11-26T00:00:00Z>November 26, 2019</time></div></header><div class=prose><p>In [the last post]({% post_url elasticsearch/2019-11-25-connecting-to-elasticsearch-from-java %}) we saw how to connect to Elasticsearch using the High Level Client.</p><h2 id=match_all-query-using-java-client><code>match_all</code> Query using Java client</h2><p>The client provides many high level methods to build an Elasticsearch query. To keep it simple, let&rsquo;s see how to construct a simple <code>match_all</code> query:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>SearchRequest request <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SearchRequest<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;online&#34;</span><span style=color:#f92672>);</span> <span style=color:#75715e>// -- 1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>SearchSourceBuilder builder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SearchSourceBuilder<span style=color:#f92672>();</span> <span style=color:#75715e>// -- 2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>builder<span style=color:#f92672>.</span><span style=color:#a6e22e>query</span><span style=color:#f92672>(</span>QueryBuilders<span style=color:#f92672>.</span><span style=color:#a6e22e>matchAllQuery</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>request<span style=color:#f92672>.</span><span style=color:#a6e22e>source</span><span style=color:#f92672>(</span>builder<span style=color:#f92672>);</span> <span style=color:#75715e>// -- 3
</span></span></span></code></pre></div><ol><li>Parameter to the constructor is the index you want to query, this can be left empty and all the indices will be queried</li><li><code>SearchSourceBuilder</code> is used to create a search request. We can create search requests with compound queries and filters using <code>SearchSourceBuilder</code></li><li>Once we have created the <code>source</code> we can set that in the query using the <code>source</code> method on the <code>SearchRequest</code> object.</li></ol><p>To find out what query was generated using the <code>SearchSourceBuilder</code> we can call the <code>toString()</code> method on it.
For example, in the above example, the following query was generated:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;query&#34;</span>:{
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;match_all&#34;</span>:{
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;boost&#34;</span>:<span style=color:#ae81ff>1.0</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=specifying-the-number-of-hits-returned>Specifying the number of hits returned</h2><p>By default Elasticsearch returns 10 hits as part of the response but this can be configured in the search request. The same thing can be achieved like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>SearchRequest request <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SearchRequest<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;online&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>SearchSourceBuilder builder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SearchSourceBuilder<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>builder<span style=color:#f92672>.</span><span style=color:#a6e22e>query</span><span style=color:#f92672>(</span>QueryBuilders<span style=color:#f92672>.</span><span style=color:#a6e22e>matchAllQuery</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>builder<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>(</span><span style=color:#ae81ff>50</span><span style=color:#f92672>);</span> <span style=color:#75715e>// 50 hits will be returned as part of response
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>request<span style=color:#f92672>.</span><span style=color:#a6e22e>source</span><span style=color:#f92672>(</span>builder<span style=color:#f92672>);</span>
</span></span></code></pre></div><p>The resultant query generated is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;size&#34;</span>:<span style=color:#ae81ff>50</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;query&#34;</span>:{
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;match_all&#34;</span>:{
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;boost&#34;</span>:<span style=color:#ae81ff>1.0</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=fetching-source>fetching source</h2><p>By default Elasticsearch fetches the source of the document that matches and this can be controlled using the <code>_source</code> parameter in the search response. In the Java client, we can set the source field like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>builder<span style=color:#f92672>.</span><span style=color:#a6e22e>fetchSource</span><span style=color:#f92672>(</span><span style=color:#66d9ef>false</span><span style=color:#f92672>);</span>
</span></span></code></pre></div><h2 id=search-response>Search Response</h2><p>The <code>SearchResponse</code> object is the parsed form of the response that Elasticsearch returns. It has the time taken, total hits, hits, etc that can be extracted.</p><p>For example, to get total number of hits, we can do:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>SearchResponse response <span style=color:#f92672>=</span> client<span style=color:#f92672>.</span><span style=color:#a6e22e>search</span><span style=color:#f92672>(</span>request<span style=color:#f92672>,</span> RequestOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>DEFAULT</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> totalHits <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span><span style=color:#a6e22e>getHits</span><span style=color:#f92672>().</span><span style=color:#a6e22e>totalHits</span><span style=color:#f92672>;</span>
</span></span></code></pre></div><p>We can get all the hits in the <code>SearchHits</code> object using <code>response.getHits()</code> method. We can iterate over all hits like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>SearchHit hit <span style=color:#f92672>:</span> response<span style=color:#f92672>.</span><span style=color:#a6e22e>getHits</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    hit<span style=color:#f92672>.</span><span style=color:#a6e22e>getSourceAsMap</span><span style=color:#f92672>();</span> <span style=color:#75715e>// this returns the actual document
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    hit<span style=color:#f92672>.</span><span style=color:#a6e22e>getId</span><span style=color:#f92672>();</span> <span style=color:#75715e>// returns the document Id
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>There are more helper methods to parse every field returned by Elasticsearch.</p><h2 id=conclusion>Conclusion</h2><p>In this article we saw how to query Elasticsearch and how to iterate over the results.</p></div><a class="text-sky-600 mr-2" href=/tags/elasticsearch>#elasticsearch</a>
<a class="text-sky-600 mr-2" href=/tags/java>#java</a><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/share?url=/elasticsearch/search-match-all-from-java-using-high-level-client/&text=Search%20Elasticsearch%20from%20Java%20using%20High%20Level%20Client" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=/elasticsearch/search-match-all-from-java-using-high-level-client/&title=Search%20Elasticsearch%20from%20Java%20using%20High%20Level%20Client" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"></a></div><aside><div class="border-t-2 py-4"><p class="text-2xl font-bold">See Also</p><ul><li><a class="hover:underline hover:text-gray-500" href=/elasticsearch/insert-index-document-elasticsearch-java/>Insert, Index document in Elasticsearch using Java</a></li><li><a class="hover:underline hover:text-gray-500" href=/elasticsearch/connect-from-java-using-high-level-client/>Connect to Elasticsearch using Java High Level Client</a></li><li><a class="hover:underline hover:text-gray-500" href=/java/creating-csv-from-strings/>Creating CSV from Strings in Java</a></li></ul></div></aside></article></main><footer class="bg-black text-white bottom-0 w-100 pa3" role=contentinfo><div class="center bg-black relative max-w-4xl mx-auto px-12 py-16"><section class=mb-4><h1 class="text-2xl uppercase">ABOUT</h1><p>Hi! I'm Suresh. Your host. You can get to know me better in the
<a class="link white dim" href=/about>about</a> section or follow me
using the social media icons on the right</p><div><div class=ananke-socials><a href=https://twitter.com/sureshssarda target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window">Twitter</a>
<a href=https://github.com/sureshsarda target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window">GitHub</a>
<a href=https://www.linkedin.com/in/sureshsarda/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window">LinkedIn</a>
<a href=https://sureshssarda.medium.com/ target=_blank class="medium ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Medium link" rel=noopener aria-label="follow on Medium——Opens in a new window">Medium</a></div></div></section><section class=mb-4><h1 class="text-2xl uppercase">categories</h1><a class=hover:text-gray-400 href=/categories/linux>linux (6)</a></section><section class=mb-4><h1 class="text-2xl uppercase">tags</h1><a class=hover:text-gray-400 href=/tags/ai>ai (1)</a>
<a class=hover:text-gray-400 href=/tags/apache-hadoop>apache-hadoop (1)</a>
<a class=hover:text-gray-400 href=/tags/apache-kafka>apache-kafka (1)</a>
<a class=hover:text-gray-400 href=/tags/apache-spark>apache-spark (1)</a>
<a class=hover:text-gray-400 href=/tags/apache-storm>apache-storm (1)</a>
<a class=hover:text-gray-400 href=/tags/big-data>big-data (1)</a>
<a class=hover:text-gray-400 href=/tags/clean-code>clean-code (3)</a>
<a class=hover:text-gray-400 href=/tags/containers>containers (1)</a>
<a class=hover:text-gray-400 href=/tags/data>data (1)</a>
<a class=hover:text-gray-400 href=/tags/design-patterns>design-patterns (2)</a>
<a class=hover:text-gray-400 href=/tags/docker>docker (2)</a>
<a class=hover:text-gray-400 href=/tags/elasticsearch>elasticsearch (5)</a>
<a class=hover:text-gray-400 href=/tags/java>java (11)</a>
<a class=hover:text-gray-400 href=/tags/linux>linux (11)</a>
<a class=hover:text-gray-400 href=/tags/linux-kernel>linux-kernel (1)</a>
<a class=hover:text-gray-400 href=/tags/notes>notes (1)</a>
<a class=hover:text-gray-400 href=/tags/performance>performance (1)</a>
<a class=hover:text-gray-400 href=/tags/power-unix-tools>power-unix-tools (1)</a>
<a class=hover:text-gray-400 href=/tags/programming>programming (2)</a>
<a class=hover:text-gray-400 href=/tags/python>python (3)</a>
<a class=hover:text-gray-400 href=/tags/reflection>reflection (1)</a>
<a class=hover:text-gray-400 href=/tags/research-paper>research-paper (2)</a>
<a class=hover:text-gray-400 href=/tags/sdlc>sdlc (1)</a>
<a class=hover:text-gray-400 href=/tags/spring>spring (2)</a>
<a class=hover:text-gray-400 href=/tags/unit-testing>unit-testing (1)</a></section><section class="mb-4 text-gray-400"><a href=/>&copy; Suresh Sarda 2022</a>
<span>Hosted on Github. Created using Tailwind CSS and Hugo.</span></section></div></div></footer></body></html>