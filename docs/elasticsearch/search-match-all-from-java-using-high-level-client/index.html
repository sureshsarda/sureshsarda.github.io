<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  
  <title>Search Elasticsearch from Java using High Level Client</title>
  <meta property="og:title" content="Search Elasticsearch from Java using High Level Client" />
  <meta name="twitter:title" content="Search Elasticsearch from Java using High Level Client" />
  

  

  <meta name="author" content=""/>
  <meta property="og:site_name" content="Programming Notes" />
  <meta property="og:url" content="https://sureshsarda.github.io/elasticsearch/search-match-all-from-java-using-high-level-client/" />

  
  <meta name="twitter:card" content="summary" />

  

  
  <meta property="og:type" content="article" />
  
  
  
  <meta name="generator" content="Hugo 0.80.0" />
  
  

  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@100;300;500;700;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Oxygen&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:wght@600&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">


  <link rel="stylesheet" href="https://sureshsarda.github.io/assets/css/style.css" />
  <link rel="stylesheet" href="https://sureshsarda.github.io/assets/css/custom.css" />
  
  
  
  <script type="text/javascript" src="https://sureshsarda.github.io/assets/js/bundle.js"></script>
</head>




<body>
    <article class="container">
        <header>
            

            
                <p>
                    <a href="/">Programming Notes</a>
                </p>
                <h1>Search Elasticsearch from Java using High Level Client</h1>
                
                <a href="https://sureshsarda.github.io/tags/Elasticsearch" class="c-tag">Elasticsearch</a>
                
                <a href="https://sureshsarda.github.io/tags/Java" class="c-tag">Java</a>
                
            
            
        </header>





        <main id="js-article" class="container">
            <div class="row">

                <div class="col-9 py-5">
                    <p>In [the last post]({% post_url elasticsearch/2019-11-25-connecting-to-elasticsearch-from-java %}) we saw how to connect to Elasticsearch using the High Level Client.</p>
<h2 id="match_all-query-using-java-client"><code>match_all</code> Query using Java client</h2>
<p>The client provides many high level methods to build an Elasticsearch query. To keep it simple, let&rsquo;s see how to construct a simple <code>match_all</code> query:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">SearchRequest request <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SearchRequest<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;online&#34;</span><span style="color:#f92672">);</span> <span style="color:#75715e">// -- 1
</span><span style="color:#75715e"></span>SearchSourceBuilder builder <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SearchSourceBuilder<span style="color:#f92672">();</span> <span style="color:#75715e">// -- 2
</span><span style="color:#75715e"></span>builder<span style="color:#f92672">.</span><span style="color:#a6e22e">query</span><span style="color:#f92672">(</span>QueryBuilders<span style="color:#f92672">.</span><span style="color:#a6e22e">matchAllQuery</span><span style="color:#f92672">());</span>
request<span style="color:#f92672">.</span><span style="color:#a6e22e">source</span><span style="color:#f92672">(</span>builder<span style="color:#f92672">);</span> <span style="color:#75715e">// -- 3
</span></code></pre></div><ol>
<li>Parameter to the constructor is the index you want to query, this can be left empty and all the indices will be queried</li>
<li><code>SearchSourceBuilder</code> is used to create a search request. We can create search requests with compound queries and filters using <code>SearchSourceBuilder</code></li>
<li>Once we have created the <code>source</code> we can set that in the query using the <code>source</code> method on the <code>SearchRequest</code> object.</li>
</ol>
<p>To find out what query was generated using the <code>SearchSourceBuilder</code> we can call the <code>toString()</code> method on it.
For example, in the above example, the following query was generated:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;query&#34;</span>:{
        <span style="color:#f92672">&#34;match_all&#34;</span>:{
            <span style="color:#f92672">&#34;boost&#34;</span>:<span style="color:#ae81ff">1.0</span>
        }
    }
}
</code></pre></div><h2 id="specifying-the-number-of-hits-returned">Specifying the number of hits returned</h2>
<p>By default Elasticsearch returns 10 hits as part of the response but this can be configured in the search request. The same thing can be achieved like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">SearchRequest request <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SearchRequest<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;online&#34;</span><span style="color:#f92672">);</span>
SearchSourceBuilder builder <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SearchSourceBuilder<span style="color:#f92672">();</span>
builder<span style="color:#f92672">.</span><span style="color:#a6e22e">query</span><span style="color:#f92672">(</span>QueryBuilders<span style="color:#f92672">.</span><span style="color:#a6e22e">matchAllQuery</span><span style="color:#f92672">());</span>
builder<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">(</span>50<span style="color:#f92672">);</span> <span style="color:#75715e">// 50 hits will be returned as part of response
</span><span style="color:#75715e"></span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">source</span><span style="color:#f92672">(</span>builder<span style="color:#f92672">);</span>
</code></pre></div><p>The resultant query generated is:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;size&#34;</span>:<span style="color:#ae81ff">50</span>,
    <span style="color:#f92672">&#34;query&#34;</span>:{
        <span style="color:#f92672">&#34;match_all&#34;</span>:{
            <span style="color:#f92672">&#34;boost&#34;</span>:<span style="color:#ae81ff">1.0</span>
        }
    }
}
</code></pre></div><h2 id="fetching-source">fetching source</h2>
<p>By default Elasticsearch fetches the source of the document that matches and this can be controlled using the <code>_source</code> parameter in the search response. In the Java client, we can set the source field like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">builder<span style="color:#f92672">.</span><span style="color:#a6e22e">fetchSource</span><span style="color:#f92672">(</span><span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>
</code></pre></div><h2 id="search-response">Search Response</h2>
<p>The <code>SearchResponse</code> object is the parsed form of the response that Elasticsearch returns. It has the time taken, total hits, hits, etc that can be extracted.</p>
<p>For example, to get total number of hits, we can do:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">SearchResponse response <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span><span style="color:#a6e22e">search</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> RequestOptions<span style="color:#f92672">.</span><span style="color:#a6e22e">DEFAULT</span><span style="color:#f92672">);</span>
<span style="color:#66d9ef">int</span> totalHits <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span><span style="color:#a6e22e">getHits</span><span style="color:#f92672">().</span><span style="color:#a6e22e">totalHits</span><span style="color:#f92672">;</span>
</code></pre></div><p>We can get all the hits in the <code>SearchHits</code> object using <code>response.getHits()</code> method. We can iterate over all hits like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>SearchHit hit <span style="color:#f92672">:</span> response<span style="color:#f92672">.</span><span style="color:#a6e22e">getHits</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
    hit<span style="color:#f92672">.</span><span style="color:#a6e22e">getSourceAsMap</span><span style="color:#f92672">();</span> <span style="color:#75715e">// this returns the actual document
</span><span style="color:#75715e"></span>    hit<span style="color:#f92672">.</span><span style="color:#a6e22e">getId</span><span style="color:#f92672">();</span> <span style="color:#75715e">// returns the document Id
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><p>There are more helper methods to parse every field returned by Elasticsearch.</p>
<h2 id="conclusion">Conclusion</h2>
<p>In this article we saw how to query Elasticsearch and how to iterate over the results.</p>


                </div>
                <aside class="bd-toc toc col-2 py-5">
                    <div class="sticky-top pt-5">
                        <h3>On this page</h3>
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#match_all-query-using-java-client"><code>match_all</code> Query using Java client</a></li>
    <li><a href="#specifying-the-number-of-hits-returned">Specifying the number of hits returned</a></li>
    <li><a href="#fetching-source">fetching source</a></li>
    <li><a href="#search-response">Search Response</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
                    </div>
                </aside>
            </div>

            

<section class="p-related">
  <h3>Related Content</h3>
  <ul>
    
    <li>
      <a href="/elasticsearch/connect-from-java-using-high-level-client/">
        <span>Connect to Elasticsearch using Java High Level Client</span>
      </a>
    </li>
    
    <li>
      <a href="/java/creating-csv-from-strings/">
        <span>Creating CSV from Strings in Java</span>
      </a>
    </li>
    
    <li>
      <a href="/posts/2017-07-02-vagrant-setting-up-and-tearing-down-development-environments-on-the-fly/">
        <span>Vagrant - Setting up and tearing down development environments on the fly</span>
      </a>
    </li>
    
  </ul>
</section>


        </main>

        
    </article>
    <footer class="mt-5 py-5">
    <div class="container py-5">
        
        <div class="row">
            <div class="col-lg-4 mb-3">
                <h3>
                    <a href="/">Programming Notes</a>
                </h3>
                <ul class="list-unstyled">
                    <li>Share the knowledge that you can and learn more in the process.</li>
                </ul>

            </div>
            <div class="col-lg-1"></div>
            
            
            <div class="col-lg-2">
                <h5>Curated</h5>
                <ul class="list-unstyled">
                    
                    <li class="mb-2"><a href="/blog">Blog</a></li>
                    
                    <li class="mb-2"><a href="/books">Books</a></li>
                    
                    <li class="mb-2"><a href="/papers">Papers</a></li>
                    
                </ul>
            </div>
            
            
            
            <div class="col-lg-2">
                <h5>Links</h5>
                <ul class="list-unstyled">
                    
                    <li class="mb-2"><a href="/series">Article Series</a></li>
                    
                    <li class="mb-2"><a href="/categories">Categories</a></li>
                    
                    <li class="mb-2"><a href="/posts">Posts</a></li>
                    
                    <li class="mb-2"><a href="/tags">Tags</a></li>
                    
                </ul>
            </div>
            
            
            
            <div class="col-lg-2">
                <h5>Social</h5>
                <ul class="list-unstyled">
                    
                    <li class="mb-2"><a href="/">Github</a></li>
                    
                    <li class="mb-2"><a href="/">LinkedIn</a></li>
                    
                    <li class="mb-2"><a href="/">Medium</a></li>
                    
                    <li class="mb-2"><a href="/">Stack Overflow</a></li>
                    
                    <li class="mb-2"><a href="/">Twitter</a></li>
                    
                </ul>
            </div>
            
            
        </div>
        
    </div>

    <div class="p-copyright">
        
        Suresh Sarda
        &nbsp;&bull;&nbsp;
        2020

        
        &nbsp;&bull;&nbsp;
        <a href="https://sureshsarda.github.io/">Programming Notes</a>
        
        
    </div>
</footer>