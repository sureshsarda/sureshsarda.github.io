<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  
  <title>Pandas: Splitting (Exploding) a column into multiple rows</title>
  <meta property="og:title" content="Pandas: Splitting (Exploding) a column into multiple rows" />
  <meta name="twitter:title" content="Pandas: Splitting (Exploding) a column into multiple rows" />
  

  
  <meta name="description" content="Learn how to split/explode a Pandas DataFrame with a column or cell with multiple values separated by a deliminator into multiple rows">
  <meta property="og:description" content="Learn how to split/explode a Pandas DataFrame with a column or cell with multiple values separated by a deliminator into multiple rows">
  <meta name="twitter:description" content="Learn how to split/explode a Pandas DataFrame with a column or cell with multiple values separated by a deliminator into multiple rows">
  

  <meta name="author" content=""/>
  <meta property="og:site_name" content="Programming Notes" />
  <meta property="og:url" content="https://sureshsarda.github.io/posts/2018-11-21-pandas-splitting-exploding-string-column-into-multiple-rows/" />

  
  <meta name="twitter:card" content="summary" />

  

  
  <meta property="og:type" content="article" />
  
  
  
  <meta name="generator" content="Hugo 0.80.0" />
  
  

  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@100;300;500;700;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Oxygen&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:wght@600&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">


  <link rel="stylesheet" href="https://sureshsarda.github.io/assets/css/style.css" />
  <link rel="stylesheet" href="https://sureshsarda.github.io/assets/css/custom.css" />
  
  
  
  <script type="text/javascript" src="https://sureshsarda.github.io/assets/js/bundle.js"></script>
</head>




<body>
    <article class="container">
        <header>
            

            
                <p>
                    <a href="/">Programming Notes</a>
                </p>
                <h1>Pandas: Splitting (Exploding) a column into multiple rows</h1>
                
                <a href="https://sureshsarda.github.io/tags/pandas" class="c-tag">pandas</a>
                
                <a href="https://sureshsarda.github.io/tags/python" class="c-tag">python</a>
                
            
            
        </header>





        <main id="js-article" class="container">
            <div class="row">

                <div class="col-9 py-5">
                    <p>Recently, while working with on something in my <a href="https://whatfix.com">office</a>, I faced a small but interesting problem. I had to clean some data and the data was not normalized. In one of the columns, a single cell had multiple comma seperated values. I could not find out the distribution of how frequently the value was appearing without splitting these cells into individual cells of their own; creating new rows.</p>
<p>Example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Input data:</span>
EmployeeId, City
<span style="color:#ae81ff">001</span>, Mumbai<span style="color:#f92672">|</span>Bangalore
<span style="color:#ae81ff">002</span>, Pune<span style="color:#f92672">|</span>Mumbai<span style="color:#f92672">|</span>Delhi
<span style="color:#ae81ff">003</span>, Mumbai<span style="color:#f92672">|</span>Bangalore
<span style="color:#ae81ff">004</span>, Mumbai<span style="color:#f92672">|</span>Pune
<span style="color:#ae81ff">005</span>, Bangalore
<span style="color:#f92672">...</span>
</code></pre></div><p>Do you see the challenge? To plot the histogram, of cities I had no choice to take the individual <code>Series</code> and work on it independently. So I decided to explode the <code>City</code> into multiple rows, so that the data becomes like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Expected format</span>
EmployeeId, City
<span style="color:#ae81ff">001</span>, Mumbai
<span style="color:#ae81ff">001</span>, Bangalore
<span style="color:#ae81ff">002</span>, Pune
<span style="color:#ae81ff">002</span>, Mumbai
<span style="color:#ae81ff">002</span>, Delhi
<span style="color:#ae81ff">003</span>, Mumbai
<span style="color:#ae81ff">003</span>, Bangalore
<span style="color:#ae81ff">004</span>, Mumbai
<span style="color:#ae81ff">004</span>, Pune
<span style="color:#ae81ff">005</span>, Bangalore
</code></pre></div><p>Apparently, there is no straightforward way to clean this in Pandas, but it&rsquo;s not that difficult either.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd

<span style="color:#75715e"># Import the data</span>
df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({
   <span style="color:#e6db74">&#39;EmployeeId&#39;</span>: [<span style="color:#e6db74">&#39;001&#39;</span>, <span style="color:#e6db74">&#39;002&#39;</span>, <span style="color:#e6db74">&#39;003&#39;</span>, <span style="color:#e6db74">&#39;004&#39;</span>, <span style="color:#e6db74">&#39;005&#39;</span>],
   <span style="color:#e6db74">&#39;City&#39;</span>: [<span style="color:#e6db74">&#39;Mumbai|Bangalore&#39;</span>, <span style="color:#e6db74">&#39;Pune|Mumbai|Delhi&#39;</span>, <span style="color:#e6db74">&#39;Mumbai|Bangalore&#39;</span>, <span style="color:#e6db74">&#39;Mumbai|Pune&#39;</span>, <span style="color:#e6db74">&#39;Bangalore&#39;</span>] 
})

<span style="color:#75715e"># Step 1</span>
<span style="color:#75715e"># We start with creating a new dataframe from the series with EmployeeId as the index</span>
new_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(df<span style="color:#f92672">.</span>City<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;|&#39;</span>)<span style="color:#f92672">.</span>tolist(), index<span style="color:#f92672">=</span>df<span style="color:#f92672">.</span>EmployeeId)<span style="color:#f92672">.</span>stack()

<span style="color:#75715e"># Step 2</span>
<span style="color:#75715e"># We now want to get rid of the secondary index</span>
<span style="color:#75715e"># To do this, we will make EmployeeId as a column (it can&#39;t be an index since the values will be duplicate)</span>
new_df <span style="color:#f92672">=</span> new_df<span style="color:#f92672">.</span>reset_index([<span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;EmployeeId&#39;</span>])

<span style="color:#75715e"># Step 3</span>
<span style="color:#75715e"># The final step is to set the column names as we want them</span>
new_df<span style="color:#f92672">.</span>columns <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;EmployeeId&#39;</span>, <span style="color:#e6db74">&#39;City&#39;</span>]

<span style="color:#75715e"># Result</span>
 EmployeeId City
<span style="color:#ae81ff">0</span> 	<span style="color:#ae81ff">001</span> 	Mumbai
<span style="color:#ae81ff">1</span> 	<span style="color:#ae81ff">001</span> 	Bangalore
<span style="color:#ae81ff">2</span> 	<span style="color:#ae81ff">002</span> 	Pune
<span style="color:#ae81ff">3</span> 	<span style="color:#ae81ff">002</span> 	Mumbai
<span style="color:#ae81ff">4</span> 	<span style="color:#ae81ff">002</span> 	Delhi
<span style="color:#ae81ff">5</span> 	<span style="color:#ae81ff">003</span> 	Mumbai
<span style="color:#ae81ff">6</span> 	<span style="color:#ae81ff">003</span> 	Bangalore
<span style="color:#ae81ff">7</span> 	<span style="color:#ae81ff">004</span> 	Mumbai
<span style="color:#ae81ff">8</span> 	<span style="color:#ae81ff">004</span> 	Pune
<span style="color:#ae81ff">9</span> 	<span style="color:#ae81ff">005</span> 	Bangalore
</code></pre></div><p>See the Jupyter Notebook [here].(<a href="https://gist.github.com/sureshsarda/00c3b7423ea7b6cba4250a719d6b7424">https://gist.github.com/sureshsarda/00c3b7423ea7b6cba4250a719d6b7424</a>)</p>
<h2 id="explanation">Explanation</h2>
<p>Step 1 is the real trick here, the other 2 steps are more of cleaning exercises to get the data into correct format.
In Step 1, we are asking Pandas to split the series into multiple values and the combine all of them into single column using the <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.stack.html">stack</a> method.
The output of Step 1 without stack looks like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-md" data-lang="md">            0 	        1 	        2
EmployeeId 			
001 	    Mumbai 	    Bangalore 	None
002 	    Pune 	    Mumbai      Delhi
003 	    Mumbai 	    Bangalore 	None
004 	    Mumbai 	    Pune        None
005 	    Bangalore       None        None
</code></pre></div><p>After this, we stack these individual indexes into one and do some cleaning using <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.reset_index.html"><code>reset_index</code></a> and <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.columns.html">change the column names</a>.</p>
<h2 id="final-code-snippet">Final Code Snippet</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Explode/Split column into multiple rows</span>
new_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(df<span style="color:#f92672">.</span>City<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;|&#39;</span>)<span style="color:#f92672">.</span>tolist(), index<span style="color:#f92672">=</span>df<span style="color:#f92672">.</span>EmployeeId)<span style="color:#f92672">.</span>stack()
new_df <span style="color:#f92672">=</span> new_df<span style="color:#f92672">.</span>reset_index([<span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;EmployeeId&#39;</span>])
new_df<span style="color:#f92672">.</span>columns <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;EmployeeId&#39;</span>, <span style="color:#e6db74">&#39;City&#39;</span>]
</code></pre></div><h2 id="read-more">Read more</h2>
<ul>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.stack.html">pandas.DataFrame.stack</a> Stack the prescribed level(s) from columns to index.</li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.reset_index.html">pandas.DataFrame.reset_index</a>: Reset index method</li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.columns.html">pandas.DataFrame.columns</a>: Change the column names</li>
</ul>


                </div>
                <aside class="bd-toc toc col-2 py-5">
                    <div class="sticky-top pt-5">
                        <h3>On this page</h3>
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#explanation">Explanation</a></li>
    <li><a href="#final-code-snippet">Final Code Snippet</a></li>
    <li><a href="#read-more">Read more</a></li>
  </ul>
</nav>
                    </div>
                </aside>
            </div>

            


        </main>

        
    </article>
    <footer class="mt-5 py-5">
    <div class="container py-5">
        
        <div class="row">
            <div class="col-lg-4 mb-3">
                <h3>
                    <a href="/">Programming Notes</a>
                </h3>
                <ul class="list-unstyled">
                    <li>Share the knowledge that you can and learn more in the process.</li>
                </ul>

            </div>
            <div class="col-lg-1"></div>
            
            
            <div class="col-lg-2">
                <h5>Curated</h5>
                <ul class="list-unstyled">
                    
                    <li class="mb-2"><a href="/blog">Blog</a></li>
                    
                    <li class="mb-2"><a href="/books">Books</a></li>
                    
                    <li class="mb-2"><a href="/papers">Papers</a></li>
                    
                </ul>
            </div>
            
            
            
            <div class="col-lg-2">
                <h5>Links</h5>
                <ul class="list-unstyled">
                    
                    <li class="mb-2"><a href="/series">Article Series</a></li>
                    
                    <li class="mb-2"><a href="/categories">Categories</a></li>
                    
                    <li class="mb-2"><a href="/posts">Posts</a></li>
                    
                    <li class="mb-2"><a href="/tags">Tags</a></li>
                    
                </ul>
            </div>
            
            
            
            <div class="col-lg-2">
                <h5>Social</h5>
                <ul class="list-unstyled">
                    
                    <li class="mb-2"><a href="/">Github</a></li>
                    
                    <li class="mb-2"><a href="/">LinkedIn</a></li>
                    
                    <li class="mb-2"><a href="/">Medium</a></li>
                    
                    <li class="mb-2"><a href="/">Stack Overflow</a></li>
                    
                    <li class="mb-2"><a href="/">Twitter</a></li>
                    
                </ul>
            </div>
            
            
        </div>
        
    </div>

    <div class="p-copyright">
        
        Suresh Sarda
        &nbsp;&bull;&nbsp;
        2020

        
        &nbsp;&bull;&nbsp;
        <a href="https://sureshsarda.github.io/">Programming Notes</a>
        
        
    </div>
</footer>