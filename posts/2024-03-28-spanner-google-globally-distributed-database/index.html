<!doctype html><html lang=en-us class=dark><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>Spanner: Google's Globally Distributed Database
| s9a.me</title>
<meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Corbett, James C., et al. &ldquo;Spanner: Google’s globally distributed database.&rdquo; ACM Transactions on Computer Systems (TOCS) 31.3 (2013): 1-22.
Spanner is a globally distributed databases, schematized semi-relational database. Data is replicated across datacenters and regions. The data is automatically sharded and distributed.
Server Organization A spanner deployment is called a universe. Given it manages data globally, there are handful of universes deployed. Universe is divided into zones. Zones can be added or removed and serve as an administrative deployment (a physical isolation)."><meta name=generator content="Hugo 0.124.1"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=/css/syntax.css><link rel=stylesheet href=/css/style.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inria+Serif:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Old+Standard+TT:ital,wght@0,400;0,700;1,400&display=swap" rel=stylesheet><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&family=Source+Sans+Pro:wght@200;300;400;700;900&display=swap"><meta property="og:title" content="Spanner: Google's Globally Distributed Database
"><meta property="og:description" content="Corbett, James C., et al. &ldquo;Spanner: Google’s globally distributed database.&rdquo; ACM Transactions on Computer Systems (TOCS) 31.3 (2013): 1-22.
Spanner is a globally distributed databases, schematized semi-relational database. Data is replicated across datacenters and regions. The data is automatically sharded and distributed.
Server Organization A spanner deployment is called a universe. Given it manages data globally, there are handful of universes deployed. Universe is divided into zones. Zones can be added or removed and serve as an administrative deployment (a physical isolation)."><meta property="og:type" content="article"><meta property="og:url" content="https://s9a.me/posts/2024-03-28-spanner-google-globally-distributed-database/"><meta property="og:image" content="https://s9a.me/images/slipbox.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-26T00:00:00+00:00"><meta property="article:modified_time" content="2024-03-28T02:47:28+00:00"><meta property="og:site_name" content="sureshsarda.me"><meta itemprop=name content="Spanner: Google's Globally Distributed Database
"><meta itemprop=description content="Corbett, James C., et al. &ldquo;Spanner: Google’s globally distributed database.&rdquo; ACM Transactions on Computer Systems (TOCS) 31.3 (2013): 1-22.
Spanner is a globally distributed databases, schematized semi-relational database. Data is replicated across datacenters and regions. The data is automatically sharded and distributed.
Server Organization A spanner deployment is called a universe. Given it manages data globally, there are handful of universes deployed. Universe is divided into zones. Zones can be added or removed and serve as an administrative deployment (a physical isolation)."><meta itemprop=datePublished content="2024-03-26T00:00:00+00:00"><meta itemprop=dateModified content="2024-03-28T02:47:28+00:00"><meta itemprop=wordCount content="804"><meta itemprop=image content="https://s9a.me/images/slipbox.jpg"><meta itemprop=keywords content="research-paper,database-management,systems,concurrency,distributed-databases,transaction-processing,google,mvcc,paxos,two-phase-commit,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s9a.me/images/slipbox.jpg"><meta name=twitter:title content="Spanner: Google's Globally Distributed Database
"><meta name=twitter:description content="Corbett, James C., et al. &ldquo;Spanner: Google’s globally distributed database.&rdquo; ACM Transactions on Computer Systems (TOCS) 31.3 (2013): 1-22.
Spanner is a globally distributed databases, schematized semi-relational database. Data is replicated across datacenters and regions. The data is automatically sharded and distributed.
Server Organization A spanner deployment is called a universe. Given it manages data globally, there are handful of universes deployed. Universe is divided into zones. Zones can be added or removed and serve as an administrative deployment (a physical isolation)."></head><body class="bg-slate-100 dark:bg-slate-900"><main><article class="center bg-white relative max-w-4xl mx-auto px-12 py-16"><header class="border-b-2 mb-8 pb-8"><aside class=print:hidden><a href=/ class="font-semibold text-base uppercase text-sky-600 hover:text-sky-900">HOME</a></aside><h1 class="text-5xl my-4">Spanner: Google's Globally Distributed Database</h1><div class=mb-4><time class="text-base text-gray-700" datetime=2024-03-26T00:00:00Z>March 26, 2024</time></div><a class="text-sky-600 hover:text-sky-900 mr-2 print:hidden" href=/tags/research-paper>#research-paper
</a><a class="text-sky-600 hover:text-sky-900 mr-2 print:hidden" href=/tags/database-management>#database-management
</a><a class="text-sky-600 hover:text-sky-900 mr-2 print:hidden" href=/tags/systems>#systems
</a><a class="text-sky-600 hover:text-sky-900 mr-2 print:hidden" href=/tags/concurrency>#concurrency
</a><a class="text-sky-600 hover:text-sky-900 mr-2 print:hidden" href=/tags/distributed-databases>#distributed-databases
</a><a class="text-sky-600 hover:text-sky-900 mr-2 print:hidden" href=/tags/transaction-processing>#transaction-processing
</a><a class="text-sky-600 hover:text-sky-900 mr-2 print:hidden" href=/tags/google>#google
</a><a class="text-sky-600 hover:text-sky-900 mr-2 print:hidden" href=/tags/mvcc>#mvcc
</a><a class="text-sky-600 hover:text-sky-900 mr-2 print:hidden" href=/tags/paxos>#paxos
</a><a class="text-sky-600 hover:text-sky-900 mr-2 print:hidden" href=/tags/two-phase-commit>#two-phase-commit</a></header><div class=prose><blockquote><p>Corbett, James C., et al. &ldquo;Spanner: Google’s globally distributed database.&rdquo; ACM Transactions on Computer Systems (TOCS) 31.3 (2013): 1-22.</p></blockquote><p>Spanner is a globally distributed databases, schematized semi-relational database. Data is replicated across datacenters and regions. The data is automatically sharded and distributed.</p><h2 id=server-organization>Server Organization</h2><p>A spanner deployment is called a universe. Given it manages data globally, there are handful of universes deployed. Universe is divided into zones. Zones can be added or removed and serve as an administrative deployment (a physical isolation). There can be one or many zones in a data center.</p><p>A zone has zonmaster and can have thousands of spanservers.</p><ul><li>Universe - very few (test, development and production, etc)</li><li>Universe Master - an ineractive console for diagnostics</li><li>Zone - one or many across on a data center, physical isolation, can be added or removed</li><li>Zone Master - responsible for maintaining data across span servers</li><li>Spanservers - one to thousands in a Zone</li><li>Placement Driver - handles movement of data across zones</li><li>Tablets - Each spanserver has 100 - 1000 tablets. A tablet is a bag of mapping (<code>key: string, timestamp:int64 -> string</code>). Implemented as Colossus, replicated as Paxos state machine.</li></ul><h2 id=truetime-api>TrueTime API</h2><p>At the heart of the database is the TrueTime API without which the transactions can&rsquo;t be implemented the way they are in Spanner.</p><p>A problem with distributed systems is the clock. Clocks are unreliable and out of sync. Having a reliable and in-sync clock would make distributed transactions much easier.</p><p>TrueTiem API provides following methods:</p><ul><li><code>TT.now()</code> - returns a <code>TT.interval: [earliest, latest]</code>. An interval with earliest possible time and latest possible time at that given instance.</li><li><code>TT.after(t)</code> - true, if <code>t</code> has <strong>definitely</strong> passed.</li><li><code>TT.before(t)</code> - true, if <code>t</code> has <strong>definitely</strong> not arrived.</li></ul><p>Atomic and GPS clocks are present in every datacenters. These clocks are spread across the datacenter to avoid an radio interference or any other design fault. Every Spanner node syncs its time with these clocks every 30 seconds. In production environement the error is observed to be not more than 6 seconds.</p><h2 id=concurrency-control>Concurrency Control</h2><blockquote><p>It is better to have application programmers deal with performance problems due to overuse of transactions as bottlenecks arise, rather than always coding the lack of transactions.</p></blockquote><p>Spanner flaunts features like externally consistent transactions, lock-free snapshot transactions, and non blocking reads in the past.</p><p>Transactions are categorized into 4 types and explained below. RW transaction requires locking where as others do not. These gurantees a whole-database read at timestamp $t$ will see the effect of all transaction at time $t$.</p><h3 id=read-write-transaction>Read Write Transaction</h3><p>Transactional read and writes use strict two phase locking. A timestamp can be assigned after all locks have been acquired but before any of them released. In Spanner, the timestamp of Paxos write is used as transaction timestamp.</p><p>Few invariants applied:</p><ul><li>A leader must assign timestamp within the interval of leader lease.</li><li>Whenever a timestamp is assigned, $s_{max}$ is advanced to $s$ to preserve disjointness.</li><li>if the start of a transaction $T_2$ occurs after commit of a transaction $T_1$, then the commit time of timestamp $T_2$ must be greater than the commit time of $T_1$.</li></ul><p>Writes are bufferd at the client until commit. That means, reads in the transaction do not see the effect of writes. This is inline that uncomitted writes are not visible. Reads use wound-wait[?] to avoid deadlock. When a client as completed all reads and buffered all writes, it begins the two-phase commit.</p><h3 id=snapshot-read-client-chosen-timestamp-or-client-chosen-bound>Snapshot Read (Client Chosen Timestamp or Client Chosen Bound)</h3><p>The monotonicity invariant allows Spanner to determine the safe timestamp value which can be used to perform the read. Every replica tracks $t_{safe}$, which is the maximum timestamp at which a replica is up-to-date. Formally, a replica can read at a timestamp $t$, if $t &lt;= t_{safe}$.</p><h3 id=snapshot-transaction>Snapshot Transaction</h3><p>A snapshot transaction executes in two phases.</p><ol><li><strong>Prepare</strong> - assign a timestamp $s_{read} = TT.now().latest$ at any time after transaction starts. This is negotiated between various Paxos groups if the read spans across.</li><li><strong>Execute</strong> the reads at $s_{read}$</li></ol><h3 id=schema-change-transactions>Schema Change Transactions</h3><p>Schema changes are supported as atomic transactions in Spanner.</p><ul><li>First, an explicitly assigned timestamp in the future is registered in the preapre phase.</li><li>Second, reads and writes, which depend on the schema change may proceed if their timestamp is before $t$, otherwise they must wait.</li></ul><p>This is a significant benefit of TrueTime. Schema change across thousands of servers can complete with minimum disruption.</p><h2 id=conclusion>Conclusion</h2><p>Spanner provides external consistency gurantee even after being a large distrubuted database with thousands of databases. Read Write transactions require locks, but reads are lock free. This is achieved using a novel time API - TrueTime which is a system of servers to synchronize clocks and can drift at most 6ms. Spanner would not have become possible without this. Apart from this, most of the techniques are not new.</p></div><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/share?url=https://s9a.me/posts/2024-03-28-spanner-google-globally-distributed-database/&amp;text=Spanner:%20Google%27s%20Globally%20Distributed%20Database%0a" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"></a><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://s9a.me/posts/2024-03-28-spanner-google-globally-distributed-database/&amp;title=Spanner:%20Google%27s%20Globally%20Distributed%20Database%0a" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"></a></div><aside class="border-t-2 print:hidden"><p class=pt-4>Want to discuss this further? You can DM me via
<a class=text-sky-500 href=https://twitter.com/sureshssarda>Twitter</a>,
<a class=text-sky-500 href=https://www.linkedin.com/in/sureshsarda/>LinkedIn</a> or directly drop an
<a class=text-sky-500 href="mailto:sureshssarda@gmail.com?subject=Spanner%3a%20Google%27s%20Globally%20Distributed%20Database%0a">Email.</a></p></aside><aside class=print:hidden><div class=py-4><p class="text-2xl font-bold">You might want to read</p><ul class="list-disc list-inside my-4"><li><a class="hover:underline hover:text-gray-500" href=/posts/2022-12-21-about-googles-mono-repo/>A brief summary of Google's Monorepo</a></li><li><a class="hover:underline hover:text-gray-500" href=/posts/2018-08-04-the-turing-test/>On The Turing Test</a></li></ul></div></aside></article><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></main><footer class="bg-black dark:bg-slate-900 text-white bottom-0 w-100 pa3 print:hidden" role=contentinfo><div class="center relative max-w-4xl mx-auto px-12 py-16"><section class=mb-4><h1 class="text-2xl uppercase hover:text-gray-300 hover:underline"><a href=/about>About</a></h1><p>Hi! I'm Suresh. Your host. You can get to know me better in the
<a class="hover:text-gray-500 hover:underline" href=/about>about</a> section or follow me
using the social media icons on the right</p><div><div class=ananke-socials><a href=https://twitter.com/sureshssarda target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window">Twitter
</a><a href=https://github.com/sureshsarda target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window">GitHub
</a><a href=https://www.linkedin.com/in/sureshsarda/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window">LinkedIn
</a><a href=https://sureshssarda.medium.com/ target=_blank class="medium ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Medium link" rel=noopener aria-label="follow on Medium——Opens in a new window">Medium</a></div></div></section><section class=mb-4><h1 class="text-2xl uppercase hover:text-gray-300 hover:underline"><a href=/categories>categories</a></h1><a class="hover:text-gray-400 hover:underline" href=/categories/linux>linux (6)</a></section><section class=mb-4><h1 class="text-2xl uppercase hover:text-gray-300 hover:underline"><a href=/tags>tags</a></h1><a class="hover:text-gray-400 hover:underline" href=/tags/ai>ai (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/apache-hadoop>apache hadoop (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/apache-kafka>apache kafka (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/apache-spark>apache spark (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/apache-storm>apache storm (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/big-data>big data (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/clean-code>clean code (5)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/concurrency>concurrency (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/containers>containers (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/data>data (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/database-management>database-management (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/databases>databases (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/design>design (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/design-patterns>design patterns (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/distributed-databases>distributed-databases (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/docker>docker (4)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/elasticsearch>elasticsearch (5)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/google>google (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/gradle>gradle (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/idea>idea (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/java>java (15)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/linux>linux (12)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/mvcc>mvcc (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/networking>networking (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/note-taking>note taking (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/notes>notes (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/paxos>paxos (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/performance>performance (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/power-unix-tools>power-unix-tools (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/programming>programming (9)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/python>python (3)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/reflection>reflection (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/research-paper>research-paper (3)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/sdlc>sdlc (3)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/spring>spring (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/systems>systems (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/testing>testing (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/transaction-processing>transaction-processing (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/two-phase-commit>two-phase-commit (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/vscode>vscode (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/writing-well>writing-well (2)</a></section><section class="mb-4 text-gray-400"><a href=https://s9a.me/>&copy; Suresh Sarda 2024</a><p class="text-sm text-gray-500">Hosted on
<a class="hover:text-gray-300 hover:underline" href=https://github.com/sureshsarda/sureshsarda.github.io>Github</a>. Handcrafted using
<a class="hover:text-gray-300 hover:underline" href=https://gohugo.io/>Hugo</a> and
<a class="hover:text-gray-300 hover:underline" href=https://tailwindcss.com/>Tailwind</a>. (Version )</p></section></div></div></footer></body></html>