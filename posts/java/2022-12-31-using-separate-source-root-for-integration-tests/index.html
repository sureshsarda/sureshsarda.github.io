<!doctype html><html lang=en-us class=dark><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Using a Separate Source Root for Integration Tests | s9a.me</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="In Java if we apply the java plugin we get two source roots - main and test to write our main code and all our tests. It&rsquo;s often useful to have a separate directory for integration tests instead of using some sort of tagging or file naming convention to run those different suites.
Let&rsquo;s do that!
First, create the directory To start with, create a new directory called integration under src directory."><meta name=generator content="Hugo 0.110.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/css/syntax.css><link rel=stylesheet href=/css/style.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&family=Source+Sans+Pro:wght@200;300;400;700;900&display=swap"><meta property="og:title" content="Using a Separate Source Root for Integration Tests"><meta property="og:description" content="In Java if we apply the java plugin we get two source roots - main and test to write our main code and all our tests. It&rsquo;s often useful to have a separate directory for integration tests instead of using some sort of tagging or file naming convention to run those different suites.
Let&rsquo;s do that!
First, create the directory To start with, create a new directory called integration under src directory."><meta property="og:type" content="article"><meta property="og:url" content="https://s9a.me/posts/java/2022-12-31-using-separate-source-root-for-integration-tests/"><meta property="og:image" content="https://s9a.me/images/slipbox.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-31T00:00:00+00:00"><meta property="article:modified_time" content="2023-01-03T18:04:38+05:30"><meta property="og:site_name" content="sureshsarda.me"><meta itemprop=name content="Using a Separate Source Root for Integration Tests"><meta itemprop=description content="In Java if we apply the java plugin we get two source roots - main and test to write our main code and all our tests. It&rsquo;s often useful to have a separate directory for integration tests instead of using some sort of tagging or file naming convention to run those different suites.
Let&rsquo;s do that!
First, create the directory To start with, create a new directory called integration under src directory."><meta itemprop=datePublished content="2022-12-31T00:00:00+00:00"><meta itemprop=dateModified content="2023-01-03T18:04:38+05:30"><meta itemprop=wordCount content="469"><meta itemprop=image content="https://s9a.me/images/slipbox.jpg"><meta itemprop=keywords content="sdlc,java,programming,gradle,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s9a.me/images/slipbox.jpg"><meta name=twitter:title content="Using a Separate Source Root for Integration Tests"><meta name=twitter:description content="In Java if we apply the java plugin we get two source roots - main and test to write our main code and all our tests. It&rsquo;s often useful to have a separate directory for integration tests instead of using some sort of tagging or file naming convention to run those different suites.
Let&rsquo;s do that!
First, create the directory To start with, create a new directory called integration under src directory."></head><body class="bg-slate-100 dark:bg-slate-900"><main><article class="center bg-white relative max-w-4xl mx-auto px-12 py-16"><header class="border-b-2 mb-8 pb-8"><aside><a href=/ class="font-semibold text-base uppercase text-sky-600 hover:text-sky-900">HOME</a></aside><h1 class="text-5xl my-4">Using a Separate Source Root for Integration Tests</h1><div class=mb-4><time class="text-base text-gray-700" datetime=2022-12-31T00:00:00Z>December 31, 2022</time></div><a class="text-sky-600 hover:text-sky-900 mr-2" href=/tags/sdlc>#sdlc</a>
<a class="text-sky-600 hover:text-sky-900 mr-2" href=/tags/java>#java</a>
<a class="text-sky-600 hover:text-sky-900 mr-2" href=/tags/programming>#programming</a>
<a class="text-sky-600 hover:text-sky-900 mr-2" href=/tags/gradle>#gradle</a></header><div class=prose><p>In Java if we apply the java plugin we get two source roots - main and test to
write our main code and all our tests.
It&rsquo;s often useful to have a separate directory for integration tests instead of
using some sort of tagging or file naming convention to run those different suites.</p><p>Let&rsquo;s do that!</p><h2 id=first-create-the-directory>First, create the directory</h2><p>To start with, create a new directory called <code>integration</code> under <code>src</code> directory.
The name can be anything, but whatever you name it, make sure to change <code>integration</code>
to that name in all the subsequent steps.</p><p>Your IDE will show this as a normal directory without any special treatment. We
will see how to fix that later.</p><h2 id=second-mark-it-as-source-root>Second, mark it as source root</h2><p>If you create a Java file in that directory, it won&rsquo;t compile. We need to inform
Gradle that this is a valid source root, and not just that, we should be able use
classes from our main source root. (Well how will you test otherwise?).</p><p>Add these lines to your <code>build.gradle</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gradle data-lang=gradle><span style=display:flex><span>sourceSets <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    integration <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        compileClasspath <span style=color:#f92672>+=</span> sourceSets<span style=color:#f92672>.</span><span style=color:#a6e22e>main</span><span style=color:#f92672>.</span><span style=color:#a6e22e>output</span>
</span></span><span style=display:flex><span>        runtimeClasspath <span style=color:#f92672>+=</span> sourceSets<span style=color:#f92672>.</span><span style=color:#a6e22e>main</span><span style=color:#f92672>.</span><span style=color:#a6e22e>output</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=third-reuse-the-dependencies>Third, reuse the dependencies</h2><p>At least it won&rsquo;t crib about <em>your</em> classes. But what about any dependency that
your are already using? Google Guava? Apache Commons? Spring Framework? Add this
piece of code to achieve that:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gradle data-lang=gradle><span style=display:flex><span>configurations <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    integrationImplementation<span style=color:#f92672>.</span><span style=color:#a6e22e>extendsFrom</span> implementation
</span></span><span style=display:flex><span>    integrationRuntimeOnly<span style=color:#f92672>.</span><span style=color:#a6e22e>extendsFrom</span> runtimeOnly
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>After this step, you should be able to run and compile your code. But if you run
your tests, Gradle will say that it didn&rsquo;t find any tests.</p><h2 id=fourth-create-a-integration-task>Fourth, create a integration task</h2><p>To help Gradle find your tests, we can either modify the existing <code>test</code> task;
or we can create a new one. We will create a new one:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gradle data-lang=gradle><span style=display:flex><span>tasks<span style=color:#f92672>.</span><span style=color:#a6e22e>register</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;integrationTest&#39;</span><span style=color:#f92672>,</span> Test<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Runs integration tests.&#39;</span>
</span></span><span style=display:flex><span>    group <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;verification&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// use these classes to find tests
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    testClassesDirs <span style=color:#f92672>=</span> sourceSets<span style=color:#f92672>.</span><span style=color:#a6e22e>integration</span><span style=color:#f92672>.</span><span style=color:#a6e22e>output</span><span style=color:#f92672>.</span><span style=color:#a6e22e>classesDirs</span>
</span></span><span style=display:flex><span>    classpath <span style=color:#f92672>=</span> sourceSets<span style=color:#f92672>.</span><span style=color:#a6e22e>integration</span><span style=color:#f92672>.</span><span style=color:#a6e22e>runtimeClasspath</span>
</span></span><span style=display:flex><span>    shouldRunAfter test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>useJUnitPlatform</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    testLogging <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        events <span style=color:#e6db74>&#34;passed&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Check if tests are running using: <code>./gradlew integrationTest</code></p><h2 id=fifth-but-optional>Fifth, but optional</h2><p>If you run <code>./gradlew integrationTest</code>, your tests should not run. But IntelliJ
will not play nice with your new source root. It will assume it&rsquo;s a source root
like the <code>main</code> directory. We can fix that.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gradle data-lang=gradle><span style=display:flex><span>apply plugin: <span style=color:#e6db74>&#39;idea&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>idea <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    module <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// by default it&#39;s assumed to be a source directory, we need to remove
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// that and add it as test directory.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        sourceDirs <span style=color:#f92672>-=</span> file<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;src/integration/java&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        testSourceDirs <span style=color:#f92672>+=</span> file<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;src/integration/java&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>That&rsquo;s all is required to create a new test source using Gradle. We can even
create new type of test roots using the same method perhaps something for e2e
tests? Or we can create new source roots as well!</p><h2 id=last-but-not-least>Last, but not least</h2><p>Credit where it&rsquo;s due:</p><ul><li><a href=https://docs.gradle.org/current/userguide/java_testing.html>Testing in Java & JVM projects on Gradle.org</a></li></ul><p>This is my 6th of 100 post in <a href=https://100daystooffload.com/>#100daysToOffload</a>.</p></div><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/share?url=https://s9a.me/posts/java/2022-12-31-using-separate-source-root-for-integration-tests/&text=Using%20a%20Separate%20Source%20Root%20for%20Integration%20Tests" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://s9a.me/posts/java/2022-12-31-using-separate-source-root-for-integration-tests/&title=Using%20a%20Separate%20Source%20Root%20for%20Integration%20Tests" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"></a></div><aside class=border-t-2><p class=pt-4>Want to discuss this further? You can DM me via
<a class=text-sky-500 href=https://twitter.com/sureshssarda>Twitter</a>,
<a class=text-sky-500 href=https://www.linkedin.com/in/sureshsarda/>LinkedIn</a> or directly drop an
<a class=text-sky-500 href="mailto:sureshssarda@gmail.com?subject=Using%20a%20Separate%20Source%20Root%20for%20Integration%20Tests">Email.</a></p></aside><aside><div class=py-4><p class="text-2xl font-bold">You might want to read</p><ul class="list-disc list-inside my-4"><li><a class="hover:underline hover:text-gray-500" href=/posts/2022-12-28-releasing-safely/>Safely Rolling Out Features Using Feature Flags</a></li><li><a class="hover:underline hover:text-gray-500" href=/posts/2022-12-21-about-googles-mono-repo/>A brief summary of Google's Monorepo</a></li><li><a class="hover:underline hover:text-gray-500" href=/posts/2023-01-07-test-containers-from-dockerfile-and-dsl/>Creating TestContainers from Dockerfile and DSL</a></li></ul></div></aside></article></main><footer class="bg-black dark:bg-slate-900 text-white bottom-0 w-100 pa3" role=contentinfo><div class="center relative max-w-4xl mx-auto px-12 py-16"><section class=mb-4><h1 class="text-2xl uppercase hover:text-gray-300 hover:underline"><a href=/about>About</a></h1><p>Hi! I'm Suresh. Your host. You can get to know me better in the
<a class="hover:text-gray-500 hover:underline" href=/about>about</a> section or follow me
using the social media icons on the right</p><div><div class=ananke-socials><a href=https://twitter.com/sureshssarda target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window">Twitter</a>
<a href=https://github.com/sureshsarda target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window">GitHub</a>
<a href=https://www.linkedin.com/in/sureshsarda/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window">LinkedIn</a>
<a href=https://sureshssarda.medium.com/ target=_blank class="medium ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Medium link" rel=noopener aria-label="follow on Medium——Opens in a new window">Medium</a></div></div></section><section class=mb-4><h1 class="text-2xl uppercase hover:text-gray-300 hover:underline"><a href=/categories>categories</a></h1><a class="hover:text-gray-400 hover:underline" href=/categories/linux>linux (6)</a></section><section class=mb-4><h1 class="text-2xl uppercase hover:text-gray-300 hover:underline"><a href=/tags>tags</a></h1><a class="hover:text-gray-400 hover:underline" href=/tags/ai>ai (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/apache-hadoop>apache-hadoop (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/apache-kafka>apache-kafka (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/apache-spark>apache-spark (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/apache-storm>apache-storm (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/big-data>big-data (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/clean-code>clean-code (4)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/containers>containers (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/data>data (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/databases>databases (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/design>design (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/design-patterns>design-patterns (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/docker>docker (4)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/elasticsearch>elasticsearch (5)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/gradle>gradle (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/idea>idea (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/java>java (13)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/linux>linux (12)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/networking>networking (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/notes>notes (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/performance>performance (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/power-unix-tools>power-unix-tools (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/programming>programming (7)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/python>python (3)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/reflection>reflection (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/research-paper>research-paper (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/sdlc>sdlc (3)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/spring>spring (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/testing>testing (2)</a></section><section class="mb-4 text-gray-400"><a href=https://s9a.me/>&copy; Suresh Sarda 2023</a><p class="text-sm text-gray-500">Hosted on
<a class="hover:text-gray-300 hover:underline" href=https://github.com/sureshsarda/sureshsarda.github.io>Github</a>. Handcrafted using
<a class="hover:text-gray-300 hover:underline" href=https://gohugo.io/>Hugo</a> and
<a class="hover:text-gray-300 hover:underline" href=https://tailwindcss.com/>Tailwind</a>. (Version 17790dc)</p></section></div></div></footer></body></html>