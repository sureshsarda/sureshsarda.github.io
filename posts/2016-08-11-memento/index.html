<!doctype html><html lang=en-us class=dark><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Memento | s9a.me</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Ever used an image editing software? We opened an image but it’s too sharp and the light is not good. We make some changes and still not satisfied, we make few more changes only to realize that the previous changes were better than these new! We want to restore to previous changes. If we were using a drawing sheet and paint brush, this task would be very difficult; perhaps impossible. But with softwares, that’s not a problem."><meta name=generator content="Hugo 0.110.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/css/syntax.css><link rel=stylesheet href=/css/style.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&family=Source+Sans+Pro:wght@200;300;400;700;900&display=swap"><meta property="og:title" content="Memento"><meta property="og:description" content="Ever used an image editing software? We opened an image but it’s too sharp and the light is not good. We make some changes and still not satisfied, we make few more changes only to realize that the previous changes were better than these new! We want to restore to previous changes. If we were using a drawing sheet and paint brush, this task would be very difficult; perhaps impossible. But with softwares, that’s not a problem."><meta property="og:type" content="article"><meta property="og:url" content="https://s9a.me/posts/2016-08-11-memento/"><meta property="og:image" content="https://s9a.me/images/slipbox.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-08-11T00:00:00+00:00"><meta property="article:modified_time" content="2022-08-23T08:42:37+05:30"><meta property="og:site_name" content="sureshsarda.me"><meta itemprop=name content="Memento"><meta itemprop=description content="Ever used an image editing software? We opened an image but it’s too sharp and the light is not good. We make some changes and still not satisfied, we make few more changes only to realize that the previous changes were better than these new! We want to restore to previous changes. If we were using a drawing sheet and paint brush, this task would be very difficult; perhaps impossible. But with softwares, that’s not a problem."><meta itemprop=datePublished content="2016-08-11T00:00:00+00:00"><meta itemprop=dateModified content="2022-08-23T08:42:37+05:30"><meta itemprop=wordCount content="806"><meta itemprop=image content="https://s9a.me/images/slipbox.jpg"><meta itemprop=keywords content="design patterns,clean code,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s9a.me/images/slipbox.jpg"><meta name=twitter:title content="Memento"><meta name=twitter:description content="Ever used an image editing software? We opened an image but it’s too sharp and the light is not good. We make some changes and still not satisfied, we make few more changes only to realize that the previous changes were better than these new! We want to restore to previous changes. If we were using a drawing sheet and paint brush, this task would be very difficult; perhaps impossible. But with softwares, that’s not a problem."></head><body class="bg-slate-100 dark:bg-slate-900"><main><article class="center bg-white relative max-w-4xl mx-auto px-12 py-16"><header class="border-b-2 mb-8 pb-8"><aside><a href=/ class="font-semibold text-base uppercase text-sky-600 hover:text-sky-900">HOME</a></aside><h1 class="text-5xl my-4">Memento</h1><div class=mb-4><time class="text-base text-gray-700" datetime=2016-08-11T00:00:00Z>August 11, 2016</time></div><a class="text-sky-600 hover:text-sky-900 mr-2" href=/tags/design-patterns>#design patterns</a>
<a class="text-sky-600 hover:text-sky-900 mr-2" href=/tags/clean-code>#clean code</a></header><div class=prose><p>Ever used an image editing software? We opened an image but it’s too sharp and the light is not good. We make some
changes and still not satisfied, we make few more changes only to realize that the previous changes were better than
these new! We want to restore to previous changes. If we were using a drawing sheet and paint brush, this task would be
very difficult; perhaps impossible. But with softwares, that’s not a problem. We can simply select the state from
history which we like the most and start working on that and continue as if we never made these new changes. Undo is one
of most ingenious tool developed. Let’s see how we can create our own undo tool in this post.</p><p>Memento or sometime also called as <strong>Token</strong> is described as follows in Gang of Four:</p><blockquote><p>Without violating encapsulation, capture and externalize an object’s internal state so that the object can be restored to this state later.</p></blockquote><p>Let’s see the most important part of this definition first:</p><blockquote><p>Without violating encapsulation, capture and externalize an object’s internal state so that the object can be restored to this state later.</p></blockquote><p>Basically, we are storing an object’s state to restore later.</p><p><em>How?</em> Externally, without violating encapsulation.</p><p>That was simple. But how to do it? Let’s take a simpler example of a Word Processor. What we need to track is the text
entered by user and restore it later when the user clicks undo. In other words, we have to <em>capture</em> the <em>text</em> such
that it can be restored later.</p><p>So say we have some object that will store the text in the document. It’s state will be the text on the document. Let’s
call this object - <em>originator</em>. Then we need a mechanism to represent the snapshot. The way we take our photograph to
preserve the moment, we need a snapshot of the text at the very instant. Let’s call the snapshot - <em>Memento</em>. Now we
need someone, who will store these snapshots and give them to us when asked. Like a caretaker but of snapshots. Let’s
call it <em>Caretaker</em>.</p><p>So we have 3 characters in our play - The <em>originator</em>, the <em>memento</em> and the <em>caretaker</em>.</p><p><em>Originator</em> will request to take snapshot or restore them. Memento <em>is</em> the snapshot and <em>caretaker</em> is going to store
them for later use.</p><h2 id=implementing-it>Implementing it</h2><p>Implementing this may sound tricky but is in fact very easy.</p><p>At the very basic level, the state of text can simple be represented like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Text</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    String currentTextInBuffer<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>and memento can be represented like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TextMemento</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    String state<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/* getters and setters ommitted */</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Now let’s look at the part that says - <em>without violating encapsulation</em>. We must not create a separate object that will
clone or get internal state of <code>Text</code> object. Instead this responsibility is of the <em>originator</em> in our case <code>Text</code>
object to provide appropriate methods for this. So let’s fix this.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Text</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    String currentTextInBuffer<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> TextMemento <span style=color:#a6e22e>getState</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        TextMemento m <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> TextMemento<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        m<span style=color:#f92672>.</span><span style=color:#a6e22e>setState</span><span style=color:#f92672>(</span>currentTextInBuffer<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> m<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setState</span><span style=color:#f92672>(</span>TextMemento m<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>currentTextInBuffer</span> <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span><span style=color:#a6e22e>getState</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>That’s good, but now we need to store some states. That too <em>externally</em>. Let’s create a caretaker object that is going
to do this.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CareTaker</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>TextMemento<span style=color:#f92672>&gt;</span> states <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> LinkedList<span style=color:#f92672>&lt;</span>TextMemento<span style=color:#f92672>&gt;();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>saveState</span><span style=color:#f92672>(</span>TextMemento m<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        states<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>m<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> TextMemento <span style=color:#a6e22e>getState</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> stateIndex<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> states<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>stateIndex<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>We have used <code>LinkedList</code> to save the state. We could use <code>Stack</code> or <code>Queue</code> depending on the requirement. We could also
provide some helper methods for example to return a state <code>nth </code>iteration previous from current state.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CareTaker</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/* previous implementation here */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Returns the previous state
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> TextMemento <span style=color:#a6e22e>getPreviousState</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> state<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>state<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>()</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Returns nth previous state
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> TextMemento <span style=color:#a6e22e>getNthPreviousState</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> n<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> state<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>state<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>()</span> <span style=color:#f92672>-</span> n<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>That’s it! We are done. With these 3 objects, we can travel time. We can save changes when required and restore them
when required!</p><h2 id=points-to-consider>Points to consider</h2><p>Using Memento might be expensive in terms of storage size. Therefore we must use it carefully and try to keep as less
internal information required as possible. We might have to keep a fixed size of the list and keep deleting older
entries from the list.</p><p>Not violating encapsulation is very important and the state of the object should never be in <em>wrong hands</em>. That is, the
object should return a Memento when asked for.</p><h2 id=examples>Examples</h2><p>When ever we have <em>incremental progress</em> of some object, we can use Memento to track and restore it!</p><p>For example user filling a very complex form or the email we type to saving and then loading a game we were playing!</p><hr><p>That was Memento pattern, Bye Bye till next time!</p></div><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/share?url=https://s9a.me/posts/2016-08-11-memento/&text=Memento" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://s9a.me/posts/2016-08-11-memento/&title=Memento" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"></a></div><aside class=border-t-2><p class=pt-4>Want to discuss this further? You can DM me via
<a class=text-sky-500 href=https://twitter.com/sureshssarda>Twitter</a>,
<a class=text-sky-500 href=https://www.linkedin.com/in/sureshsarda/>LinkedIn</a> or directly drop an
<a class=text-sky-500 href="mailto:sureshssarda@gmail.com?subject=Memento">Email.</a></p></aside><aside><div class=py-4><p class="text-2xl font-bold">You might want to read</p><ul class="list-disc list-inside my-4"><li><a class="hover:underline hover:text-gray-500" href=/posts/2021-11-30-design-patterns-for-container-application/>Design Patterns for Container Based Distributed Systems</a></li><li><a class="hover:underline hover:text-gray-500" href=/posts/2023-01-15-spotless-checkstyle-alternative-apply-formatting/>Spotless - an alternative to Checkstyle that applies the formatting</a></li><li><a class="hover:underline hover:text-gray-500" href=/posts/2023-01-04-side-effect-free-functions/>Side Effect Free Functions</a></li></ul></div></aside></article></main><footer class="bg-black dark:bg-slate-900 text-white bottom-0 w-100 pa3" role=contentinfo><div class="center relative max-w-4xl mx-auto px-12 py-16"><section class=mb-4><h1 class="text-2xl uppercase hover:text-gray-300 hover:underline"><a href=/about>About</a></h1><p>Hi! I'm Suresh. Your host. You can get to know me better in the
<a class="hover:text-gray-500 hover:underline" href=/about>about</a> section or follow me
using the social media icons on the right</p><div><div class=ananke-socials><a href=https://twitter.com/sureshssarda target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window">Twitter</a>
<a href=https://github.com/sureshsarda target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window">GitHub</a>
<a href=https://www.linkedin.com/in/sureshsarda/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window">LinkedIn</a>
<a href=https://sureshssarda.medium.com/ target=_blank class="medium ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Medium link" rel=noopener aria-label="follow on Medium——Opens in a new window">Medium</a></div></div></section><section class=mb-4><h1 class="text-2xl uppercase hover:text-gray-300 hover:underline"><a href=/categories>categories</a></h1><a class="hover:text-gray-400 hover:underline" href=/categories/linux>linux (6)</a></section><section class=mb-4><h1 class="text-2xl uppercase hover:text-gray-300 hover:underline"><a href=/tags>tags</a></h1><a class="hover:text-gray-400 hover:underline" href=/tags/ai>ai (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/apache-hadoop>apache-hadoop (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/apache-kafka>apache-kafka (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/apache-spark>apache-spark (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/apache-storm>apache-storm (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/big-data>big-data (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/clean-code>clean-code (5)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/containers>containers (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/data>data (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/databases>databases (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/design>design (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/design-patterns>design-patterns (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/docker>docker (4)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/elasticsearch>elasticsearch (5)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/gradle>gradle (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/idea>idea (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/java>java (14)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/linux>linux (12)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/networking>networking (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/notes>notes (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/performance>performance (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/power-unix-tools>power-unix-tools (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/programming>programming (7)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/python>python (3)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/reflection>reflection (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/research-paper>research-paper (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/sdlc>sdlc (3)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/spring>spring (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/testing>testing (2)</a></section><section class="mb-4 text-gray-400"><a href=https://s9a.me/>&copy; Suresh Sarda 2023</a><p class="text-sm text-gray-500">Hosted on
<a class="hover:text-gray-300 hover:underline" href=https://github.com/sureshsarda/sureshsarda.github.io>Github</a>. Handcrafted using
<a class="hover:text-gray-300 hover:underline" href=https://gohugo.io/>Hugo</a> and
<a class="hover:text-gray-300 hover:underline" href=https://tailwindcss.com/>Tailwind</a>. (Version 17790dc)</p></section></div></div></footer></body></html>