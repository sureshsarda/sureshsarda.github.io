<!doctype html><html lang=en-us class=dark><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>Creating TestContainers from Dockerfile and DSL | s9a.me</title>
<meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Containers make the job of writing integration test cases quite easy which rely on a tool like a database or cloud infrastructure or any other tool for that matter. Test containers take it a step further but letting us create containers from the code itself.
There is another neat trick in TestContainers that let’s us create the containers on the fly. From Dockerfile or directly by declaring the container spec with Java using a DSL."><meta name=generator content="Hugo 0.121.2"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/css/syntax.css><link rel=stylesheet href=/css/style.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&family=Source+Sans+Pro:wght@200;300;400;700;900&display=swap"><meta property="og:title" content="Creating TestContainers from Dockerfile and DSL"><meta property="og:description" content="Containers make the job of writing integration test cases quite easy which rely on a tool like a database or cloud infrastructure or any other tool for that matter. Test containers take it a step further but letting us create containers from the code itself.
There is another neat trick in TestContainers that let’s us create the containers on the fly. From Dockerfile or directly by declaring the container spec with Java using a DSL."><meta property="og:type" content="article"><meta property="og:url" content="https://s9a.me/posts/2023-01-07-test-containers-from-dockerfile-and-dsl/"><meta property="og:image" content="https://s9a.me/images/slipbox.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-07T00:00:00+00:00"><meta property="article:modified_time" content="2023-01-25T08:46:58+05:30"><meta property="og:site_name" content="sureshsarda.me"><meta itemprop=name content="Creating TestContainers from Dockerfile and DSL"><meta itemprop=description content="Containers make the job of writing integration test cases quite easy which rely on a tool like a database or cloud infrastructure or any other tool for that matter. Test containers take it a step further but letting us create containers from the code itself.
There is another neat trick in TestContainers that let’s us create the containers on the fly. From Dockerfile or directly by declaring the container spec with Java using a DSL."><meta itemprop=datePublished content="2023-01-07T00:00:00+00:00"><meta itemprop=dateModified content="2023-01-25T08:46:58+05:30"><meta itemprop=wordCount content="384"><meta itemprop=image content="https://s9a.me/images/slipbox.jpg"><meta itemprop=keywords content="testing,programming,java,docker,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s9a.me/images/slipbox.jpg"><meta name=twitter:title content="Creating TestContainers from Dockerfile and DSL"><meta name=twitter:description content="Containers make the job of writing integration test cases quite easy which rely on a tool like a database or cloud infrastructure or any other tool for that matter. Test containers take it a step further but letting us create containers from the code itself.
There is another neat trick in TestContainers that let’s us create the containers on the fly. From Dockerfile or directly by declaring the container spec with Java using a DSL."></head><body class="bg-slate-100 dark:bg-slate-900"><main><article class="center bg-white relative max-w-4xl mx-auto px-12 py-16"><header class="border-b-2 mb-8 pb-8"><aside><a href=/ class="font-semibold text-base uppercase text-sky-600 hover:text-sky-900">HOME</a></aside><h1 class="text-5xl my-4">Creating TestContainers from Dockerfile and DSL</h1><div class=mb-4><time class="text-base text-gray-700" datetime=2023-01-07T00:00:00Z>January 7, 2023</time></div><a class="text-sky-600 hover:text-sky-900 mr-2" href=/tags/testing>#testing
</a><a class="text-sky-600 hover:text-sky-900 mr-2" href=/tags/programming>#programming
</a><a class="text-sky-600 hover:text-sky-900 mr-2" href=/tags/java>#java
</a><a class="text-sky-600 hover:text-sky-900 mr-2" href=/tags/docker>#docker</a></header><div class=prose><p>Containers make the job of writing integration test cases quite easy which rely
on a tool like a database or cloud infrastructure or any other tool for that
matter. Test containers take it a step further but letting us create containers
from the code itself.</p><p>There is another neat trick in TestContainers that let’s us create the
containers on the fly. From Dockerfile or directly by declaring the container
spec with Java using a DSL. Let’s see how to do this.</p><h2 id=dockerfile-to-create-containers-for-testcontainers>Dockerfile to create containers for TestContainers</h2><p>The below code snippet create a container from the Dockerfile present in the
classpath. The advantages are quite obvious where we don’t need the tool out of
the box but some configurations are applied on the top of it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Rule</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> GenericContainer dslContainer <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> GenericContainer(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>new</span> ImageFromDockerfile()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>withFileFromClasspath</span>(<span style=color:#e6db74>&#34;Dockerfile&#34;</span>, <span style=color:#e6db74>&#34;test-containers/Dockerfile&#34;</span>))
</span></span></code></pre></div><p>For example, while the <code>JDBCContainer</code> provides the <code>initScript</code> method to load
the initial data, but it would be much better to use a container directly which
has the data set up already. This should speed up the creation process since
the layers will be cached by Docker and containers will be created much faster.</p><p>We can even experiment and test with such containers independently.</p><h2 id=using-dsl-to-build-containers>Using DSL to build containers</h2><p>If a Dockerfile is not sufficient, and we still need more dynamic way of
creating containers. Or say we want to test a feature against various database
implementations or perhaps we want to test our <code>ffmpeg</code> against various
operating systems. We can create containers dynamically using the DSL that
TestContainers provide. See this code snippet below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>var</span> images <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> String<span style=color:#f92672>[]</span> {<span style=color:#e6db74>&#34;ubuntu&#34;</span>, <span style=color:#e6db74>&#34;alpine&#34;</span>};
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> (image in images) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>new</span> GenericContainer(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> ImageFromDockerfile()
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>withDockerfileFromBuilder</span>(builder <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>                         builder
</span></span><span style=display:flex><span>                                 .<span style=color:#a6e22e>from</span>(image <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;:latest&#34;</span>)
</span></span><span style=display:flex><span>                                 .<span style=color:#a6e22e>run</span>(<span style=color:#e6db74>&#34;sudo apt install --update ffmpeg&#34;</span>)
</span></span><span style=display:flex><span>                                 .<span style=color:#a6e22e>build</span>()))
</span></span><span style=display:flex><span>                 .<span style=color:#a6e22e>withExposedPorts</span>(80);
</span></span><span style=display:flex><span> <span style=color:#75715e>// run some tests here</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><p>So while TestContainers make it easy to test against tools like Databases,
Cloud Services and many other out of the box support of tools. It now let’s us
create any container that’s possible using a Dockerfile and not just that; we
can even create these containers dynamically.</p><p>Of course, when the DSL gets complex enough, another option is to use the
Dockerfile with some velocity template and generate these Dockerfiles
dynamically. They can also be fed to TestContainers!</p><hr><p>This is my 8th of 100 post in <a href=https://100daystooffload.com/>#100daysToOffload</a>.</p></div><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/share?url=https://s9a.me/posts/2023-01-07-test-containers-from-dockerfile-and-dsl/&amp;text=Creating%20TestContainers%20from%20Dockerfile%20and%20DSL" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"></a><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://s9a.me/posts/2023-01-07-test-containers-from-dockerfile-and-dsl/&amp;title=Creating%20TestContainers%20from%20Dockerfile%20and%20DSL" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"></a></div><aside class=border-t-2><p class=pt-4>Want to discuss this further? You can DM me via
<a class=text-sky-500 href=https://twitter.com/sureshssarda>Twitter</a>,
<a class=text-sky-500 href=https://www.linkedin.com/in/sureshsarda/>LinkedIn</a> or directly drop an
<a class=text-sky-500 href="mailto:sureshssarda@gmail.com?subject=Creating%20TestContainers%20from%20Dockerfile%20and%20DSL">Email.</a></p></aside><aside><div class=py-4><p class="text-2xl font-bold">You might want to read</p><ul class="list-disc list-inside my-4"><li><a class="hover:underline hover:text-gray-500" href=/posts/2023-12-13-proxy-interfaces/>Proxy Interfaces In Java</a></li><li><a class="hover:underline hover:text-gray-500" href=/posts/java/2022-12-31-using-separate-source-root-for-integration-tests/>Using a Separate Source Root for Integration Tests</a></li><li><a class="hover:underline hover:text-gray-500" href=/posts/2022-12-17-proxy-new-instance-json-mock-utility/>Create a service mocking framework around Proxy.newProxyInstance</a></li></ul></div></aside></article></main><footer class="bg-black dark:bg-slate-900 text-white bottom-0 w-100 pa3" role=contentinfo><div class="center relative max-w-4xl mx-auto px-12 py-16"><section class=mb-4><h1 class="text-2xl uppercase hover:text-gray-300 hover:underline"><a href=/about>About</a></h1><p>Hi! I'm Suresh. Your host. You can get to know me better in the
<a class="hover:text-gray-500 hover:underline" href=/about>about</a> section or follow me
using the social media icons on the right</p><div><div class=ananke-socials><a href=https://twitter.com/sureshssarda target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window">Twitter
</a><a href=https://github.com/sureshsarda target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window">GitHub
</a><a href=https://www.linkedin.com/in/sureshsarda/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window">LinkedIn
</a><a href=https://sureshssarda.medium.com/ target=_blank class="medium ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Medium link" rel=noopener aria-label="follow on Medium——Opens in a new window">Medium</a></div></div></section><section class=mb-4><h1 class="text-2xl uppercase hover:text-gray-300 hover:underline"><a href=/categories>categories</a></h1><a class="hover:text-gray-400 hover:underline" href=/categories/linux>linux (6)</a></section><section class=mb-4><h1 class="text-2xl uppercase hover:text-gray-300 hover:underline"><a href=/tags>tags</a></h1><a class="hover:text-gray-400 hover:underline" href=/tags/ai>ai (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/apache-hadoop>apache-hadoop (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/apache-kafka>apache-kafka (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/apache-spark>apache-spark (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/apache-storm>apache-storm (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/big-data>big-data (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/clean-code>clean-code (5)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/containers>containers (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/data>data (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/databases>databases (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/design>design (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/design-patterns>design-patterns (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/docker>docker (4)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/elasticsearch>elasticsearch (5)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/gradle>gradle (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/idea>idea (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/java>java (15)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/linux>linux (12)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/networking>networking (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/note-taking>note-taking (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/notes>notes (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/performance>performance (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/power-unix-tools>power-unix-tools (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/programming>programming (9)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/python>python (3)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/reflection>reflection (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/research-paper>research-paper (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/sdlc>sdlc (3)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/spring>spring (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/testing>testing (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/vscode>vscode (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/writing-well>writing-well (2)</a></section><section class="mb-4 text-gray-400"><a href=https://s9a.me/>&copy; Suresh Sarda 2024</a><p class="text-sm text-gray-500">Hosted on
<a class="hover:text-gray-300 hover:underline" href=https://github.com/sureshsarda/sureshsarda.github.io>Github</a>. Handcrafted using
<a class="hover:text-gray-300 hover:underline" href=https://gohugo.io/>Hugo</a> and
<a class="hover:text-gray-300 hover:underline" href=https://tailwindcss.com/>Tailwind</a>. (Version 17790dc)</p></section></div></div></footer></body></html>