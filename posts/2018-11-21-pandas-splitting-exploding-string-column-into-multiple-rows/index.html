<!doctype html><html lang=en-us class=dark><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Pandas: Splitting (Exploding) a column into multiple rows | s9a.me</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Learn how to split/explode a Pandas DataFrame with a column or cell with multiple values separated by a deliminator into multiple rows"><meta name=generator content="Hugo 0.109.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=/css/syntax.css><link rel=stylesheet href=/css/style.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&family=Source+Sans+Pro:wght@200;300;400;700;900&display=swap"><meta property="og:title" content="Pandas: Splitting (Exploding) a column into multiple rows"><meta property="og:description" content="Learn how to split/explode a Pandas DataFrame with a column or cell with multiple values separated by a deliminator into multiple rows"><meta property="og:type" content="article"><meta property="og:url" content="/posts/2018-11-21-pandas-splitting-exploding-string-column-into-multiple-rows/"><meta property="og:image" content="/images/slipbox.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-11-21T10:00:00+00:00"><meta property="article:modified_time" content="2018-11-21T10:00:00+00:00"><meta property="og:site_name" content="sureshsarda.me"><meta itemprop=name content="Pandas: Splitting (Exploding) a column into multiple rows"><meta itemprop=description content="Learn how to split/explode a Pandas DataFrame with a column or cell with multiple values separated by a deliminator into multiple rows"><meta itemprop=datePublished content="2018-11-21T10:00:00+00:00"><meta itemprop=dateModified content="2018-11-21T10:00:00+00:00"><meta itemprop=wordCount content="462"><meta itemprop=image content="/images/slipbox.jpg"><meta itemprop=keywords content="data,python,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/images/slipbox.jpg"><meta name=twitter:title content="Pandas: Splitting (Exploding) a column into multiple rows"><meta name=twitter:description content="Learn how to split/explode a Pandas DataFrame with a column or cell with multiple values separated by a deliminator into multiple rows"></head><body class="bg-slate-100 dark:bg-slate-900"><main><article class="center bg-white relative max-w-4xl mx-auto px-12 py-16"><header class="border-b-2 mb-8"><aside><a href=/ class="font-semibold text-base uppercase text-sky-700">HOME</a></aside><h1 class="text-5xl my-4">Pandas: Splitting (Exploding) a column into multiple rows</h1><div class=mb-12><time class="text-base text-gray-700" datetime=2018-11-21T10:00:00Z>November 21, 2018</time></div></header><div class=prose><p>Recently, while working with on something in my <a href=https://whatfix.com>office</a>, I faced a small but interesting problem. I had to clean some data and the data was not normalized. In one of the columns, a single cell had multiple comma seperated values. I could not find out the distribution of how frequently the value was appearing without splitting these cells into individual cells of their own; creating new rows.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Input data:</span>
</span></span><span style=display:flex><span>EmployeeId, City
</span></span><span style=display:flex><span><span style=color:#ae81ff>001</span>, Mumbai<span style=color:#f92672>|</span>Bangalore
</span></span><span style=display:flex><span><span style=color:#ae81ff>002</span>, Pune<span style=color:#f92672>|</span>Mumbai<span style=color:#f92672>|</span>Delhi
</span></span><span style=display:flex><span><span style=color:#ae81ff>003</span>, Mumbai<span style=color:#f92672>|</span>Bangalore
</span></span><span style=display:flex><span><span style=color:#ae81ff>004</span>, Mumbai<span style=color:#f92672>|</span>Pune
</span></span><span style=display:flex><span><span style=color:#ae81ff>005</span>, Bangalore
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span></code></pre></div><p>Do you see the challenge? To plot the histogram, of cities I had no choice to take the individual <code>Series</code> and work on it independently. So I decided to explode the <code>City</code> into multiple rows, so that the data becomes like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Expected format</span>
</span></span><span style=display:flex><span>EmployeeId, City
</span></span><span style=display:flex><span><span style=color:#ae81ff>001</span>, Mumbai
</span></span><span style=display:flex><span><span style=color:#ae81ff>001</span>, Bangalore
</span></span><span style=display:flex><span><span style=color:#ae81ff>002</span>, Pune
</span></span><span style=display:flex><span><span style=color:#ae81ff>002</span>, Mumbai
</span></span><span style=display:flex><span><span style=color:#ae81ff>002</span>, Delhi
</span></span><span style=display:flex><span><span style=color:#ae81ff>003</span>, Mumbai
</span></span><span style=display:flex><span><span style=color:#ae81ff>003</span>, Bangalore
</span></span><span style=display:flex><span><span style=color:#ae81ff>004</span>, Mumbai
</span></span><span style=display:flex><span><span style=color:#ae81ff>004</span>, Pune
</span></span><span style=display:flex><span><span style=color:#ae81ff>005</span>, Bangalore
</span></span></code></pre></div><p>Apparently, there is no straightforward way to clean this in Pandas, but it&rsquo;s not that difficult either.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Import the data</span>
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame({
</span></span><span style=display:flex><span>   <span style=color:#e6db74>&#39;EmployeeId&#39;</span>: [<span style=color:#e6db74>&#39;001&#39;</span>, <span style=color:#e6db74>&#39;002&#39;</span>, <span style=color:#e6db74>&#39;003&#39;</span>, <span style=color:#e6db74>&#39;004&#39;</span>, <span style=color:#e6db74>&#39;005&#39;</span>],
</span></span><span style=display:flex><span>   <span style=color:#e6db74>&#39;City&#39;</span>: [<span style=color:#e6db74>&#39;Mumbai|Bangalore&#39;</span>, <span style=color:#e6db74>&#39;Pune|Mumbai|Delhi&#39;</span>, <span style=color:#e6db74>&#39;Mumbai|Bangalore&#39;</span>, <span style=color:#e6db74>&#39;Mumbai|Pune&#39;</span>, <span style=color:#e6db74>&#39;Bangalore&#39;</span>] 
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 1</span>
</span></span><span style=display:flex><span><span style=color:#75715e># We start with creating a new dataframe from the series with EmployeeId as the index</span>
</span></span><span style=display:flex><span>new_df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(df<span style=color:#f92672>.</span>City<span style=color:#f92672>.</span>str<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;|&#39;</span>)<span style=color:#f92672>.</span>tolist(), index<span style=color:#f92672>=</span>df<span style=color:#f92672>.</span>EmployeeId)<span style=color:#f92672>.</span>stack()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 2</span>
</span></span><span style=display:flex><span><span style=color:#75715e># We now want to get rid of the secondary index</span>
</span></span><span style=display:flex><span><span style=color:#75715e># To do this, we will make EmployeeId as a column (it can&#39;t be an index since the values will be duplicate)</span>
</span></span><span style=display:flex><span>new_df <span style=color:#f92672>=</span> new_df<span style=color:#f92672>.</span>reset_index([<span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#39;EmployeeId&#39;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 3</span>
</span></span><span style=display:flex><span><span style=color:#75715e># The final step is to set the column names as we want them</span>
</span></span><span style=display:flex><span>new_df<span style=color:#f92672>.</span>columns <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;EmployeeId&#39;</span>, <span style=color:#e6db74>&#39;City&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Result</span>
</span></span><span style=display:flex><span> EmployeeId City
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> 	<span style=color:#ae81ff>001</span> 	Mumbai
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> 	<span style=color:#ae81ff>001</span> 	Bangalore
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span> 	<span style=color:#ae81ff>002</span> 	Pune
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span> 	<span style=color:#ae81ff>002</span> 	Mumbai
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> 	<span style=color:#ae81ff>002</span> 	Delhi
</span></span><span style=display:flex><span><span style=color:#ae81ff>5</span> 	<span style=color:#ae81ff>003</span> 	Mumbai
</span></span><span style=display:flex><span><span style=color:#ae81ff>6</span> 	<span style=color:#ae81ff>003</span> 	Bangalore
</span></span><span style=display:flex><span><span style=color:#ae81ff>7</span> 	<span style=color:#ae81ff>004</span> 	Mumbai
</span></span><span style=display:flex><span><span style=color:#ae81ff>8</span> 	<span style=color:#ae81ff>004</span> 	Pune
</span></span><span style=display:flex><span><span style=color:#ae81ff>9</span> 	<span style=color:#ae81ff>005</span> 	Bangalore
</span></span></code></pre></div><p>See the Jupyter Notebook [here].(<a href=https://gist.github.com/sureshsarda/00c3b7423ea7b6cba4250a719d6b7424>https://gist.github.com/sureshsarda/00c3b7423ea7b6cba4250a719d6b7424</a>)</p><h2 id=explanation>Explanation</h2><p>Step 1 is the real trick here, the other 2 steps are more of cleaning exercises to get the data into correct format.
In Step 1, we are asking Pandas to split the series into multiple values and the combine all of them into single column using the <a href=https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.stack.html>stack</a> method.
The output of Step 1 without stack looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-md data-lang=md><span style=display:flex><span>            0 	        1 	        2
</span></span><span style=display:flex><span>EmployeeId 			
</span></span><span style=display:flex><span>001 	    Mumbai 	    Bangalore 	None
</span></span><span style=display:flex><span>002 	    Pune 	    Mumbai      Delhi
</span></span><span style=display:flex><span>003 	    Mumbai 	    Bangalore 	None
</span></span><span style=display:flex><span>004 	    Mumbai 	    Pune        None
</span></span><span style=display:flex><span>005 	    Bangalore       None        None
</span></span></code></pre></div><p>After this, we stack these individual indexes into one and do some cleaning using <a href=https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.reset_index.html><code>reset_index</code></a> and <a href=https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.columns.html>change the column names</a>.</p><h2 id=final-code-snippet>Final Code Snippet</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Explode/Split column into multiple rows</span>
</span></span><span style=display:flex><span>new_df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(df<span style=color:#f92672>.</span>City<span style=color:#f92672>.</span>str<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;|&#39;</span>)<span style=color:#f92672>.</span>tolist(), index<span style=color:#f92672>=</span>df<span style=color:#f92672>.</span>EmployeeId)<span style=color:#f92672>.</span>stack()
</span></span><span style=display:flex><span>new_df <span style=color:#f92672>=</span> new_df<span style=color:#f92672>.</span>reset_index([<span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#39;EmployeeId&#39;</span>])
</span></span><span style=display:flex><span>new_df<span style=color:#f92672>.</span>columns <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;EmployeeId&#39;</span>, <span style=color:#e6db74>&#39;City&#39;</span>]
</span></span></code></pre></div><h2 id=read-more>Read more</h2><ul><li><a href=https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.stack.html>pandas.DataFrame.stack</a> Stack the prescribed level(s) from columns to index.</li><li><a href=https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.reset_index.html>pandas.DataFrame.reset_index</a>: Reset index method</li><li><a href=https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.columns.html>pandas.DataFrame.columns</a>: Change the column names</li></ul></div><a class="text-sky-600 mr-2" href=/tags/data>#data</a>
<a class="text-sky-600 mr-2" href=/tags/python>#python</a><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/share?url=/posts/2018-11-21-pandas-splitting-exploding-string-column-into-multiple-rows/&text=Pandas:%20Splitting%20%28Exploding%29%20a%20column%20into%20multiple%20rows" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=/posts/2018-11-21-pandas-splitting-exploding-string-column-into-multiple-rows/&title=Pandas:%20Splitting%20%28Exploding%29%20a%20column%20into%20multiple%20rows" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"></a></div><aside><div class="border-t-2 py-4"><p class="text-2xl font-bold">See Also</p><ul><li><a class="hover:underline hover:text-gray-500" href=/posts/2019-09-28-creating-your-first-docker-image/>Create your first Docker container</a></li><li><a class="hover:underline hover:text-gray-500" href=/posts/2017-08-03-boilerplate-for-logging-in-python/>Boilerplate - Logging in Python</a></li></ul></div></aside></article></main><footer class="bg-black dark:bg-slate-900 text-white bottom-0 w-100 pa3" role=contentinfo><div class="center relative max-w-4xl mx-auto px-12 py-16"><section class=mb-4><h1 class="text-2xl uppercase hover:text-gray-500"><a href=/about>About</a></h1><p>Hi! I'm Suresh. Your host. You can get to know me better in the
<a class="link white dim" href=/about>about</a> section or follow me
using the social media icons on the right</p><div><div class=ananke-socials><a href=https://twitter.com/sureshssarda target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window">Twitter</a>
<a href=https://github.com/sureshsarda target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window">GitHub</a>
<a href=https://www.linkedin.com/in/sureshsarda/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window">LinkedIn</a>
<a href=https://sureshssarda.medium.com/ target=_blank class="medium ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Medium link" rel=noopener aria-label="follow on Medium——Opens in a new window">Medium</a></div></div></section><section class=mb-4><h1 class="text-2xl uppercase hover:text-gray-500"><a href=/categories>categories</a></h1><a class=hover:text-gray-400 href=/categories/linux>linux (6)</a></section><section class=mb-4><h1 class="text-2xl uppercase hover:text-gray-500"><a href=/tags>tags</a></h1><a class=hover:text-gray-400 href=/tags/ai>ai (1)</a>
<a class=hover:text-gray-400 href=/tags/apache-hadoop>apache-hadoop (1)</a>
<a class=hover:text-gray-400 href=/tags/apache-kafka>apache-kafka (1)</a>
<a class=hover:text-gray-400 href=/tags/apache-spark>apache-spark (1)</a>
<a class=hover:text-gray-400 href=/tags/apache-storm>apache-storm (1)</a>
<a class=hover:text-gray-400 href=/tags/big-data>big-data (1)</a>
<a class=hover:text-gray-400 href=/tags/clean-code>clean-code (3)</a>
<a class=hover:text-gray-400 href=/tags/containers>containers (1)</a>
<a class=hover:text-gray-400 href=/tags/data>data (1)</a>
<a class=hover:text-gray-400 href=/tags/design-patterns>design-patterns (2)</a>
<a class=hover:text-gray-400 href=/tags/docker>docker (2)</a>
<a class=hover:text-gray-400 href=/tags/elasticsearch>elasticsearch (5)</a>
<a class=hover:text-gray-400 href=/tags/java>java (11)</a>
<a class=hover:text-gray-400 href=/tags/linux>linux (11)</a>
<a class=hover:text-gray-400 href=/tags/linux-kernel>linux-kernel (1)</a>
<a class=hover:text-gray-400 href=/tags/notes>notes (1)</a>
<a class=hover:text-gray-400 href=/tags/performance>performance (1)</a>
<a class=hover:text-gray-400 href=/tags/power-unix-tools>power-unix-tools (1)</a>
<a class=hover:text-gray-400 href=/tags/programming>programming (2)</a>
<a class=hover:text-gray-400 href=/tags/python>python (3)</a>
<a class=hover:text-gray-400 href=/tags/reflection>reflection (1)</a>
<a class=hover:text-gray-400 href=/tags/research-paper>research-paper (2)</a>
<a class=hover:text-gray-400 href=/tags/sdlc>sdlc (1)</a>
<a class=hover:text-gray-400 href=/tags/spring>spring (2)</a>
<a class=hover:text-gray-400 href=/tags/unit-testing>unit-testing (1)</a></section><section class="mb-4 text-gray-400"><a href=/>&copy; Suresh Sarda 2022</a>
<span>Hosted on Github. Created using Tailwind CSS and Hugo.</span></section></div></div></footer></body></html>