<!doctype html><html lang=en-us class=dark><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>A brief summary of Google's Monorepo | s9a.me</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="I&rsquo;ll first talk about the code repo and how Goole makes it work, followed by the pros and cons and in the end whether it&rsquo;s needed today.
About Most of the code in Google is written in a single repository - taking mono repos to the another level. This article is a summary of another paper title Why Google stores billions of lines of code in a single repository published by Rachel Potvin."><meta name=generator content="Hugo 0.109.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/css/syntax.css><link rel=stylesheet href=/css/style.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&family=Source+Sans+Pro:wght@200;300;400;700;900&display=swap"><meta property="og:title" content="A brief summary of Google's Monorepo"><meta property="og:description" content="I&rsquo;ll first talk about the code repo and how Goole makes it work, followed by the pros and cons and in the end whether it&rsquo;s needed today.
About Most of the code in Google is written in a single repository - taking mono repos to the another level. This article is a summary of another paper title Why Google stores billions of lines of code in a single repository published by Rachel Potvin."><meta property="og:type" content="article"><meta property="og:url" content="https://s9a.me/posts/2022-12-21-about-googles-mono-repo/"><meta property="og:image" content="https://s9a.me/images/slipbox.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-21T00:00:00+00:00"><meta property="article:modified_time" content="2022-12-30T08:47:21+05:30"><meta property="og:site_name" content="sureshsarda.me"><meta itemprop=name content="A brief summary of Google's Monorepo"><meta itemprop=description content="I&rsquo;ll first talk about the code repo and how Goole makes it work, followed by the pros and cons and in the end whether it&rsquo;s needed today.
About Most of the code in Google is written in a single repository - taking mono repos to the another level. This article is a summary of another paper title Why Google stores billions of lines of code in a single repository published by Rachel Potvin."><meta itemprop=datePublished content="2022-12-21T00:00:00+00:00"><meta itemprop=dateModified content="2022-12-30T08:47:21+05:30"><meta itemprop=wordCount content="739"><meta itemprop=image content="https://s9a.me/images/slipbox.jpg"><meta itemprop=keywords content="sdlc,notes,programming,research-paper,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s9a.me/images/slipbox.jpg"><meta name=twitter:title content="A brief summary of Google's Monorepo"><meta name=twitter:description content="I&rsquo;ll first talk about the code repo and how Goole makes it work, followed by the pros and cons and in the end whether it&rsquo;s needed today.
About Most of the code in Google is written in a single repository - taking mono repos to the another level. This article is a summary of another paper title Why Google stores billions of lines of code in a single repository published by Rachel Potvin."></head><body class="bg-slate-100 dark:bg-slate-900"><main><article class="center bg-white relative max-w-4xl mx-auto px-12 py-16"><header class="border-b-2 mb-8 pb-8"><aside><a href=/ class="font-semibold text-base uppercase text-sky-600 hover:text-sky-900">HOME</a></aside><h1 class="text-5xl my-4">A brief summary of Google's Monorepo</h1><div class=mb-4><time class="text-base text-gray-700" datetime=2022-12-21T00:00:00Z>December 21, 2022</time></div><a class="text-sky-600 hover:text-sky-900 mr-2" href=/tags/sdlc>#sdlc</a>
<a class="text-sky-600 hover:text-sky-900 mr-2" href=/tags/notes>#notes</a>
<a class="text-sky-600 hover:text-sky-900 mr-2" href=/tags/programming>#programming</a>
<a class="text-sky-600 hover:text-sky-900 mr-2" href=/tags/research-paper>#research-paper</a></header><div class=prose><p>I&rsquo;ll first talk about the code repo and how Goole makes it work, followed by the pros and cons and in the end whether it&rsquo;s needed today.</p><h2 id=about>About</h2><p>Most of the code in Google is written in a single repository - taking mono repos to the another level. This article is a summary of another paper title <a href=https://dl.acm.org/doi/10.1145/2854146>Why Google stores billions of lines of code in a single repository</a> published by Rachel Potvin.</p><p>Let&rsquo;s start with a few stats about this repo:</p><ol><li>1 billion files</li><li>History of about 35 million commits</li><li>18 years of existence</li><li>86 TB of data</li><li>9 million source files</li><li>2 billion lines of code</li><li>15 million lines changes in 250k files on a weekly basis in around 2014</li><li>16k manual and 24k automated commits on a workday</li><li>And many more!</li></ol><p>These stats are insane! A repository of size 86TB!!</p><h3 id=piper>Piper</h3><p>The paper goes into the background. There are two primary systems - Piper and CitC. Piper is implemented on top of Spanner and stores the entire code base. The file level access control is maintained through ACLs to guard business critical algorithms and few configuration files. There is also a system that tracks read and writes to files to maintain audit trail.</p><h3 id=citc>CitC</h3><p>Now obviously you can’t ‘clone’ and repository to your local. Therefore, they have created a new tool called &lsquo;CitC&rsquo; or &lsquo;Clients in Cloud&rsquo; which is basically a Linux FUSE file system that copies a part of the repository for you to work on. This is architected to save space. Only space required is the local copy of modified files. Some variant of overlay file system it seems. This gives a seamless view of the entire Piper repository and your changes overlaid on the top of that. Snapshots are stores in CitC - can be tagged, previous snapshots can be recovered, can be named and sent for review. I see a strong resemblance to commits here.</p><p>These CitC, as they are on clouds can be created on the fly. So your context is not lost and you can work across multiple items without switching ‘branches’. These can be shared with other developers as well.</p><h2 id=truck-based-development>Truck Based Development</h2><p>The trunk based development has few advantages - there are no long lived branches. Only release branch perhaps. But not other feature branches or development branches. Features are controlled via flags. This adds some complexity to the code but basically every feature is then behind a feature flag. This let’s quickly rollout or disable features without a binary release. Once the feature flag is retired, the code is deleted.</p><p>There are few best practices to make this work.</p><ul><li>To avoid breakage, where thousands of engineers are committing every single day; Google has an automated testing infrastructure to test code dependent code on ever change committed.</li><li>If widespread build breaks then there is system in place to automatically revert the change.</li><li>There is also a pre-submit infrastructure that provides automated testing before change is merged.</li><li>Critique, a code review tool is created on the top of Piper to perform code reviews</li></ul><h2 id=pros-and-cons-advocated>Pros and Cons advocated</h2><p>The advantages mentioned in this paper are unified versioning, one source of truth, extensive code sharing, large scale refactoring, collaboration across teams, code visibility and implicit team namepsacing.</p><p>None of these advantages are unique to this system. This is already present with something like Gitlab.</p><p>The cons of the system are huge - there is a significant effort involved to maintain this system when you can get this for free with Gitlab (technically not free, you have to pay them).</p><h2 id=my-thoughts>My Thoughts</h2><p>Git was released around 2005 and before that time the Subversion and Mercurial were not that matured. Google ventured in the mono repo approach and created tools as and when it needed them. Not these tools work fine for them but perhaps are an overkill for any other organization which has Git and Github/Gitlab readily available. Not just an overkill, it&rsquo;s simply not necessary.</p><p>I really like the idea of CitC where you can work without switching contexts and share your work with your team mates. But all this investment just to achieve that is not worth it. Newer tools like Codespaces can enable CitC.</p><p>Bottom line, Google uses these tools because they are using them from since the start. It&rsquo;s like legacy tools which they can&rsquo;t get rid of easily.</p><hr><p>This is my 3rd of 100 post in <a href=https://100daystooffload.com/>#100daysToOffload</a>.</p></div><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/share?url=https://s9a.me/posts/2022-12-21-about-googles-mono-repo/&text=A%20brief%20summary%20of%20Google%27s%20Monorepo" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://s9a.me/posts/2022-12-21-about-googles-mono-repo/&title=A%20brief%20summary%20of%20Google%27s%20Monorepo" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"></a></div><aside class=border-t-2><p class=pt-4>Want to discuss this further? You can DM me via
<a class=text-sky-500 href=https://twitter.com/sureshssarda>Twitter</a>,
<a class=text-sky-500 href=https://www.linkedin.com/in/sureshsarda/>LinkedIn</a> or directly drop an
<a class=text-sky-500 href="mailto:sureshssarda@gmail.com?subject=A%20brief%20summary%20of%20Google%27s%20Monorepo">Email.</a></p></aside><aside><div class=py-4><p class="text-2xl font-bold">You might want to read</p><ul class="list-disc list-inside my-4"><li><a class="hover:underline hover:text-gray-500" href=/posts/databases/2022-12-24-fundamental-join-algorithms/>Fundamental Join Algorithms and IO Cost</a></li><li><a class="hover:underline hover:text-gray-500" href=/posts/2018-08-04-the-turing-test/>On The Turing Test</a></li><li><a class="hover:underline hover:text-gray-500" href=/posts/2017-07-02-vagrant-setting-up-and-tearing-down-development-environments-on-the-fly/>Vagrant - Setting up and tearing down development environments on the fly</a></li></ul></div></aside></article></main><footer class="bg-black dark:bg-slate-900 text-white bottom-0 w-100 pa3" role=contentinfo><div class="center relative max-w-4xl mx-auto px-12 py-16"><section class=mb-4><h1 class="text-2xl uppercase hover:text-gray-300 hover:underline"><a href=/about>About</a></h1><p>Hi! I'm Suresh. Your host. You can get to know me better in the
<a class="hover:text-gray-500 hover:underline" href=/about>about</a> section or follow me
using the social media icons on the right</p><div><div class=ananke-socials><a href=https://twitter.com/sureshssarda target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window">Twitter</a>
<a href=https://github.com/sureshsarda target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window">GitHub</a>
<a href=https://www.linkedin.com/in/sureshsarda/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window">LinkedIn</a>
<a href=https://sureshssarda.medium.com/ target=_blank class="medium ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Medium link" rel=noopener aria-label="follow on Medium——Opens in a new window">Medium</a></div></div></section><section class=mb-4><h1 class="text-2xl uppercase hover:text-gray-300 hover:underline"><a href=/categories>categories</a></h1><a class="hover:text-gray-400 hover:underline" href=/categories/linux>linux (6)</a></section><section class=mb-4><h1 class="text-2xl uppercase hover:text-gray-300 hover:underline"><a href=/tags>tags</a></h1><a class="hover:text-gray-400 hover:underline" href=/tags/ai>ai (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/apache-hadoop>apache-hadoop (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/apache-kafka>apache-kafka (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/apache-spark>apache-spark (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/apache-storm>apache-storm (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/big-data>big-data (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/clean-code>clean-code (3)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/containers>containers (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/data>data (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/databases>databases (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/design-patterns>design-patterns (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/docker>docker (3)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/elasticsearch>elasticsearch (5)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/java>java (11)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/linux>linux (12)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/networking>networking (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/notes>notes (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/performance>performance (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/power-unix-tools>power-unix-tools (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/programming>programming (3)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/python>python (3)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/reflection>reflection (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/research-paper>research-paper (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/sdlc>sdlc (1)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/spring>spring (2)</a>
<a class="hover:text-gray-400 hover:underline" href=/tags/testing>testing (1)</a></section><section class="mb-4 text-gray-400"><a href=https://s9a.me/>&copy; Suresh Sarda 2022</a><p class="text-sm text-gray-500">Hosted on
<a class="hover:text-gray-300 hover:underline" href=https://github.com/sureshsarda/sureshsarda.github.io>Github</a>. Handcrafted using
<a class="hover:text-gray-300 hover:underline" href=https://gohugo.io/>Hugo</a> and
<a class="hover:text-gray-300 hover:underline" href=https://tailwindcss.com/>Tailwind</a>. (Version 17790dc)</p></section></div></div></footer></body></html>