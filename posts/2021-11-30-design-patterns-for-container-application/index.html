<!doctype html><html lang=en-us class=dark><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Design Patterns for Container Based Distributed Systems | s9a.me</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="This article is inspired from paper titled with the same name published by Brendan Burns and David Oppenheimer
Containers now a days are becoming more and more analogous to objects in object-oriented programming. Like objects, containers should be small and should do one and only one thing. That’s just another way of saying Single Responsibility Principle. We are seeing a similar trend from the late 1980s and early 1990s when object-oriented programming revolutionized software development."><meta name=generator content="Hugo 0.109.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=/css/syntax.css><link rel=stylesheet href=/css/style.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&family=Source+Sans+Pro:wght@200;300;400;700;900&display=swap"><meta property="og:title" content="Design Patterns for Container Based Distributed Systems"><meta property="og:description" content="This article is inspired from paper titled with the same name published by Brendan Burns and David Oppenheimer
Containers now a days are becoming more and more analogous to objects in object-oriented programming. Like objects, containers should be small and should do one and only one thing. That’s just another way of saying Single Responsibility Principle. We are seeing a similar trend from the late 1980s and early 1990s when object-oriented programming revolutionized software development."><meta property="og:type" content="article"><meta property="og:url" content="/posts/2021-11-30-design-patterns-for-container-application/"><meta property="og:image" content="/images/slipbox.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-11-30T00:00:00+00:00"><meta property="article:modified_time" content="2021-11-30T00:00:00+00:00"><meta property="og:site_name" content="sureshsarda.me"><meta itemprop=name content="Design Patterns for Container Based Distributed Systems"><meta itemprop=description content="This article is inspired from paper titled with the same name published by Brendan Burns and David Oppenheimer
Containers now a days are becoming more and more analogous to objects in object-oriented programming. Like objects, containers should be small and should do one and only one thing. That’s just another way of saying Single Responsibility Principle. We are seeing a similar trend from the late 1980s and early 1990s when object-oriented programming revolutionized software development."><meta itemprop=datePublished content="2021-11-30T00:00:00+00:00"><meta itemprop=dateModified content="2021-11-30T00:00:00+00:00"><meta itemprop=wordCount content="922"><meta itemprop=image content="/images/slipbox.jpg"><meta itemprop=keywords content="design patterns,clean code,docker,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/images/slipbox.jpg"><meta name=twitter:title content="Design Patterns for Container Based Distributed Systems"><meta name=twitter:description content="This article is inspired from paper titled with the same name published by Brendan Burns and David Oppenheimer
Containers now a days are becoming more and more analogous to objects in object-oriented programming. Like objects, containers should be small and should do one and only one thing. That’s just another way of saying Single Responsibility Principle. We are seeing a similar trend from the late 1980s and early 1990s when object-oriented programming revolutionized software development."></head><body class="bg-slate-100 dark:bg-slate-900"><main><article class="center bg-white relative max-w-4xl mx-auto px-4 sm:px-12 py-16"><header class="border-b-2 mb-8"><aside><a href=/ class="font-semibold text-base uppercase text-sky-700">HOME</a>
<a href=/category/essay class="font-semibold text-base uppercase text-sky-700">&bull; ESSAY</a></aside><h1 class="text-5xl my-4">Design Patterns for Container Based Distributed Systems</h1><div class=mb-12><time class="text-base text-gray-700" datetime=2021-11-30T00:00:00Z>November 30, 2021</time></div></header><div class=prose><p><em>This article is inspired from paper titled with the same name published by Brendan Burns and David Oppenheimer</em></p><p>Containers now a days are becoming more and more analogous to objects in object-oriented programming. Like objects, containers should be small and should do one and only one thing. That’s just another way of saying Single Responsibility Principle. We are seeing a similar trend from the late 1980s and early 1990s when object-oriented programming revolutionized software development. Containers have become the “object” in the distributed systems. Like objects, they expose an API. They have erected a wall so that other containers can’t interfere. Like design patterns for objects, we have design patterns for containers too. And now I think we are just waiting for another Gang of Four.</p><p>In this article we will see few single node, multi-container application patterns. Meaning, these patterns are applicable to a single host machine (or kpod for Kubernetes or task group for Nomad).</p><h2 id=side-car-pattern>Side Car Pattern</h2><p><em>Sidecar extends/enhances the main container.</em></p><p>Well, that’s the gist of it. Imagine anything add-on that you want to run with your main container. If you are familiar with the decorator pattern (in Object-Oriented world), I would say this is that.</p><p>The standard use cases explained everywhere for this pattern is log saver — your application writes logs to the disk and a side-car container pushes these logs to some other service. Although this can be incorporated in the same container but “separation of concerns”, “single responsibility” and all these fancy terms ask us not to. I would try to come up with some hypothetical use cases of Sidecar pattern.</p><h3 id=use-cases>Use Cases</h3><ol><li><p>You have a monitoring system where you want to push metric from your main container (could be logs, could be few numbers, could be anything else).</p></li><li><p>You need to periodically pull data from another service or update a local cache based on that.</p></li><li><p>You need to send emails to your users, and you already have this is a container built. Now that container can be reused.</p></li><li><p>Hazelcast supports this pattern wherein instead of having a separate cluster, you could just run sidecars with your main container and groups of these container would form a cluster.</p></li></ol><figure><img src=sidecar.png alt="Sidecard example with a main container and two sidecars to collect metrics and push logs"><figcaption><p>Figure 1: Example of sidecar pattern with a main container and two sidecars to collect metrics and push logs in a single deployment unit</p></figcaption></figure><h2 id=ambassador-pattern>Ambassador Pattern</h2><p><em>Acts as a proxy to another container world</em></p><p>Ambassadors are possible because containers in a pod share the same network. So, you can simply connect via localhost. Now, when you are developing something, you don’t have to worry about connecting to clusters and all, you can just connect to a service on localhost, and you are done. The ambassador handles connecting to the cluster or some third-party service. First it becomes easy to code. Second, it’s easy to test since you just need this ambassador and not the actual service.</p><h3 id=use-cases-1>Use Cases</h3><ol><li><p>Connecting to a SMTP service like SendGrid when you have a simplified interface in localhost but all the talking is taken care by the ambassador.</p></li><li><p>Your third party service needs security. You can offload the interaction in ambassador container and main container can simply communicate to the ambassador.</p></li><li><p>Ambassador can also take care of retries in case communicating with an unreliable service.</p></li><li><p>Although you would have a central place to manage your API, but ambassador can be used to act as a circuit breaker when you want other services connecting to your container.</p></li></ol><figure><img src=ambassador.png alt="Ambasador pattern"><figcaption><p>Figure 2: Example of Ambassador container that interacts with a 3rd party SMTP service. It manages all interaction including security, retires in case of failure</p></figcaption></figure><h2 id=adapter-pattern>Adapter Pattern</h2><p><em>Just like the adapter pattern of object-oriented world</em></p><p>An adapter like the adapter design pattern presents the main container to the outside world with a predefined interface. It adapts to a requirement that our container is supposed to adhere.</p><p>For example, consider that you have a monitoring service that expects all the containers to expose isHealthy and getHealthStats endpoints on a certain port. Now it’s possible that few containers don’t comply with this requirement or for few containers this information is not readily available or you need to query 3 different endpoints to get this. An adapter comes to the rescue. The main container can run without any changes. We deploy an adapter that performs all these tasks and exposes the required endpoints.</p><p>As with the adapter of object-oriented world, the use cases are many. I’ll try to add some hypothetical applications.</p><h3 id=use-cases-2>Use Cases</h3><ol><li><p>You have a work execution framework with different kind of work units that must comply with a single interface.</p></li><li><p>Your main container provides endpoints over web-socket, but you need them over HTTPS.</p></li><li><p>Your container has a single API format, but different services expect it to have it in their format. So, you deploy multiple adapters to adhere to those requirements.</p></li></ol><figure><img src=adapter.png alt="Ambasador pattern"><figcaption><p>Figure 3: Example of Adapter pattern. The Monitoring Adapter exposes endpoints to track the health of the main container adhering to the unified interface required by the centralized monitoring system</p></figcaption></figure><h2 id=summary>Summary</h2><p>We are seeing a similar trend that we saw with objects in object oriented paradigm. Containers have become objects and few of the design patterns are getting reused. We saw three design patterns:</p><ul><li>Sidecard, Decorator. Deploy additional functionality with the main container, augment it’s behavior.</li><li>Ambassador, Gateway. Offload communication to another container</li><li>Adapter, Adapter. Adhere to requirements/standards from outside our control</li></ul><h2 id=references>References</h2><ul><li>Burns, Brendan and Oppenheimer, David. Design patterns for container-based distributed systems</li><li><a href=https://docs.microsoft.com/en-us/azure/architecture/patterns/ambassador>Ambassador Pattern, Microsoft Cloud Design Patterns</a></li><li><a href=https://hazelcast.com/blog/hazelcast-sidecar-container-pattern/>Hazelcast Sidecar Container Pattern</a></li></ul></div><a class="text-sky-600 mr-2" href=/tags/design-patterns>#design patterns</a>
<a class="text-sky-600 mr-2" href=/tags/clean-code>#clean code</a>
<a class="text-sky-600 mr-2" href=/tags/docker>#docker</a><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/share?url=/posts/2021-11-30-design-patterns-for-container-application/&text=Design%20Patterns%20for%20Container%20Based%20Distributed%20Systems" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=/posts/2021-11-30-design-patterns-for-container-application/&title=Design%20Patterns%20for%20Container%20Based%20Distributed%20Systems" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"></a></div><aside><div class="border-t-2 py-4"><p class="text-2xl font-bold">See Also</p><ul><li><a class="hover:underline hover:text-gray-500" href=/posts/2016-08-11-memento/>Memento</a></li><li><a class="hover:underline hover:text-gray-500" href=/posts/2020-01-06-design-oop-avoid-using-nulls-method-argument/>Why you should not use null as a method parameter</a></li><li><a class="hover:underline hover:text-gray-500" href=/posts/2019-09-28-creating-your-first-docker-image/>Create your first Docker container</a></li></ul></div></aside></article></main><footer class="bg-black dark:bg-slate-900 text-white bottom-0 w-100 pa3" role=contentinfo><div class="center relative max-w-4xl mx-auto px-4 sm:px-12 py-16"><section class=mb-4><h1 class="text-2xl uppercase">ABOUT</h1><p>Hi! I'm Suresh. Your host. You can get to know me better in the
<a class="link white dim" href=/about>about</a> section or follow me
using the social media icons on the right</p><div><div class=ananke-socials><a href=https://twitter.com/sureshssarda target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window">Twitter</a>
<a href=https://github.com/sureshsarda target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window">GitHub</a>
<a href=https://www.linkedin.com/in/sureshsarda/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window">LinkedIn</a>
<a href=https://sureshssarda.medium.com/ target=_blank class="medium ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Medium link" rel=noopener aria-label="follow on Medium——Opens in a new window">Medium</a></div></div></section><section class=mb-4><h1 class="text-2xl uppercase">categories</h1><a class=hover:text-gray-400 href=/categories/linux>linux (6)</a></section><section class=mb-4><h1 class="text-2xl uppercase">tags</h1><a class=hover:text-gray-400 href=/tags/ai>ai (1)</a>
<a class=hover:text-gray-400 href=/tags/apache-hadoop>apache-hadoop (1)</a>
<a class=hover:text-gray-400 href=/tags/apache-kafka>apache-kafka (1)</a>
<a class=hover:text-gray-400 href=/tags/apache-spark>apache-spark (1)</a>
<a class=hover:text-gray-400 href=/tags/apache-storm>apache-storm (1)</a>
<a class=hover:text-gray-400 href=/tags/big-data>big-data (1)</a>
<a class=hover:text-gray-400 href=/tags/clean-code>clean-code (3)</a>
<a class=hover:text-gray-400 href=/tags/containers>containers (1)</a>
<a class=hover:text-gray-400 href=/tags/data>data (1)</a>
<a class=hover:text-gray-400 href=/tags/design-patterns>design-patterns (2)</a>
<a class=hover:text-gray-400 href=/tags/docker>docker (2)</a>
<a class=hover:text-gray-400 href=/tags/elasticsearch>elasticsearch (5)</a>
<a class=hover:text-gray-400 href=/tags/java>java (11)</a>
<a class=hover:text-gray-400 href=/tags/linux>linux (11)</a>
<a class=hover:text-gray-400 href=/tags/linux-kernel>linux-kernel (1)</a>
<a class=hover:text-gray-400 href=/tags/notes>notes (1)</a>
<a class=hover:text-gray-400 href=/tags/performance>performance (1)</a>
<a class=hover:text-gray-400 href=/tags/power-unix-tools>power-unix-tools (1)</a>
<a class=hover:text-gray-400 href=/tags/programming>programming (2)</a>
<a class=hover:text-gray-400 href=/tags/python>python (3)</a>
<a class=hover:text-gray-400 href=/tags/reflection>reflection (1)</a>
<a class=hover:text-gray-400 href=/tags/research-paper>research-paper (2)</a>
<a class=hover:text-gray-400 href=/tags/sdlc>sdlc (1)</a>
<a class=hover:text-gray-400 href=/tags/spring>spring (2)</a>
<a class=hover:text-gray-400 href=/tags/unit-testing>unit-testing (1)</a></section><section class="mb-4 text-gray-400"><a href=/>&copy; Suresh Sarda 2022</a>
<span>Hosted on Github. Created using Tailwind CSS and Hugo.</span></section></div></div></footer></body></html>